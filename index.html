<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weibull å¯é åº¦åˆ†æ - é›™çµ„æ¯”å°ç‰ˆ (Mouldexå°ˆç”¨)</title>

    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

        :root {
            /* Dark Mode (Default) */
            --bg-body: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --text-main: #f1f5f9;
            --text-sub: #94a3b8;
            --panel-bg: rgba(30, 41, 59, 0.8);
            --panel-border: rgba(255, 255, 255, 0.1);
            --card-bg: rgba(30, 41, 59, 0.9);
            --input-bg: #1e293b;
            --input-border: #334155;
            --input-focus: #38bdf8;
            --table-header: #1e293b;
            --table-border: #334155;
            --table-row-even: rgba(255, 255, 255, 0.02);
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            --title-gradient: linear-gradient(to right, #38bdf8, #818cf8);
            --accent-a: #38bdf8;
            --accent-b: #fb7185;
            --btn-text: #ffffff;
        }

        .light-mode {
            /* Light Mode (Optional) */
            --bg-body: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --text-main: #2d3748;
            --text-sub: #718096;
            --panel-bg: rgba(255, 255, 255, 0.9);
            --panel-border: rgba(0, 0, 0, 0.05);
            --card-bg: #ffffff;
            --input-bg: #ffffff;
            --input-border: #ccc;
            --input-focus: #3498db;
            --table-header: #34495e;
            --table-border: #ddd;
            --table-row-even: #f9f9f9;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --title-gradient: linear-gradient(to right, #2c3e50, #4ca1af);
            --accent-a: #4facfe;
            --accent-b: #ff758c;
            --btn-text: #ffffff;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--bg-body);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-main);
            transition: background 0.3s, color 0.3s;
        }

        mjx-assistive-mml {
            display: none !important;
        }

        .container {
            max-width: 98%;
            margin: 0 auto;
            background: transparent;
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: 90vh;
        }

        h1.main-title {
            text-align: center;
            background: var(--title-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            border-bottom: 2px solid var(--panel-border);
            padding-bottom: 15px;
            margin-bottom: 20px;
            font-size: 1.8em;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .container {
            animation: fadeInUp 0.6s ease-out;
            width: 95%;
            margin: 0 auto;
            max-width: 1150px;
            padding-bottom: 50px;
        }

        h2 {
            color: var(--text-main);
            margin-top: 15px;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-left: 5px solid var(--accent-a);
            padding-left: 15px;
            background: linear-gradient(90deg, rgba(56, 189, 248, 0.1) 0%, rgba(255, 255, 255, 0) 100%);
            padding-top: 5px;
            padding-bottom: 5px;
            border-radius: 0 4px 4px 0;
        }

        h3 {
            color: var(--accent-a);
            margin-top: 25px;
        }

        .row {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            justify-content: center;
        }

        .col-left {
            flex: 1;
            max-width: 340px;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .col-right {
            flex: 1;
            min-width: 600px;
            max-width: 1000px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .dual-input-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .group-panel {
            border: none;
            border-radius: 12px;
            padding: 20px;
            background: var(--panel-bg);
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            transition: transform 0.2s, background 0.3s;
        }

        .group-panel:hover {
            transform: translateY(-2px);
        }

        .group-panel.group-a {
            border-left: 4px solid var(--accent-a);
        }

        .group-panel.group-b {
            border-left: 4px solid var(--accent-b);
        }

        .group-header {
            font-size: 1em;
            font-weight: 700;
            margin-bottom: 15px;
            padding: 5px 0;
            border-bottom: 2px solid var(--panel-border);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: transparent;
            text-align: left;
        }

        .group-header.group-a {
            border-color: var(--accent-a);
            color: var(--accent-a);
        }

        .group-header.group-b {
            border-color: var(--accent-b);
            color: var(--accent-b);
        }

        label {
            font-weight: bold;
            display: block;
            margin-top: 10px;
            font-size: 0.9em;
            color: var(--text-main);
        }

        input.calc-input,
        select.calc-input {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            box-sizing: border-box;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            font-size: 14px;
            background: var(--input-bg);
            color: var(--text-main);
        }

        input.calc-input:focus,
        select.calc-input:focus {
            border-color: var(--input-focus);
            outline: none;
            box-shadow: 0 0 5px rgba(56, 189, 248, 0.5);
        }

        button {
            width: 100%;
            padding: 10px;
            margin-top: 8px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            color: var(--btn-text);
            transition: all 0.2s ease;
            font-size: 0.9em;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        button:active {
            transform: translateY(1px);
        }

        .btn-add {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .btn-add:hover {
            filter: brightness(1.1);
        }

        .btn-add-b {
            background: linear-gradient(135deg, #ff758c 0%, #ff7eb3 100%);
        }

        .btn-add-b:hover {
            filter: brightness(1.1);
        }

        .btn-calc {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: #1a5c37;
        }

        .btn-demo {
            background-color: #f39c12;
        }

        .btn-clear {
            background: #64748b;
        }

        .btn-del {
            background-color: #ef4444;
            width: auto;
            padding: 4px 8px;
            font-size: 0.75em;
        }

        .btn-uniform {
            font-size: 0.95em;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            white-space: nowrap;
            background: var(--accent-a);
        }

        .btn-export {
            background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
            color: #4a2c6d;
        }

        .btn-report {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: #7a2e05;
        }

        .btn-clear-all {
            background: linear-gradient(135deg, #ff0844 0%, #ffb199 100%);
        }

        .btn-theory {
            background: #334155;
        }

        .export-grid,
        .export-grid-three,
        .export-grid-four,
        .export-grid-five,
        .export-grid-six {
            display: grid;
            gap: 10px;
            margin-top: 10px;
        }

        .export-grid {
            grid-template-columns: 1fr 1fr;
        }

        .export-grid-three {
            grid-template-columns: 1fr 1fr 1fr;
        }

        .export-grid-four {
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        }

        .export-grid-five {
            grid-template-columns: repeat(5, 1fr);
        }

        .export-grid-six {
            grid-template-columns: repeat(6, 1fr);
        }

        #reportArea {
            position: relative;
        }

        .btn-batch,
        .btn-batch-b {
            background-color: #0d9488;
        }

        .btn-batch:hover,
        .btn-batch-b:hover {
            background-color: #0f766e;
        }

        /* æ‰¹æ¬¡è¼¸å…¥å½ˆå‡ºè¦–çª— */
        .batch-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .batch-modal-content {
            background-color: var(--card-bg);
            margin: 5% auto;
            padding: 30px;
            border-radius: 12px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--panel-border);
            color: var(--text-main);
        }

        .batch-modal-header {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--accent-a);
            margin-bottom: 15px;
            border-bottom: 2px solid var(--accent-a);
            padding-bottom: 10px;
        }

        .batch-textarea {
            width: 100%;
            height: 200px;
            padding: 10px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            font-family: "Courier New", monospace;
            font-size: 14px;
            resize: vertical;
            box-sizing: border-box;
            background: var(--input-bg);
            color: var(--text-main);
        }

        .batch-textarea:focus {
            border-color: var(--accent-a);
            outline: none;
        }

        .batch-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .batch-help {
            background-color: rgba(13, 148, 136, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: var(--text-sub);
            border-left: 4px solid #0d9488;
        }

        .table-container {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            border: 1px solid var(--table-border);
            border-radius: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
        }

        th,
        td {
            border: 1px solid var(--table-border);
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: var(--table-header);
            color: var(--text-main);
            position: sticky;
            top: 0;
            font-weight: 700;
        }

        tr:nth-child(even) {
            background-color: var(--table-row-even);
        }

        .result-panel {
            background: var(--panel-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--panel-border);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 5px;
            box-shadow: var(--shadow);
            display: none;
            margin-left: auto;
            margin-right: auto;
            width: 90%;
            max-width: 1000px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 5px;
        }

        .group-result {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid var(--panel-border);
            position: relative;
        }

        .group-result h4 {
            margin: 0 0 8px 0;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-main);
        }

        .group-result.group-a {
            border-left: 4px solid var(--accent-a);
            background: rgba(56, 189, 248, 0.05);
        }

        .group-result.group-b {
            border-left: 4px solid var(--accent-b);
            background: rgba(251, 113, 133, 0.05);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 4px 8px;
            border-radius: 4px;
            display: flex;
            align-items: baseline;
            gap: 6px;
        }

        .stat-label {
            font-size: 0.75em;
            color: var(--text-sub);
            font-weight: 600;
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 1.1em;
            font-weight: 700;
            font-family: 'Inter', monospace;
            color: var(--text-main);
        }

        .desc-text {
            font-size: 0.8em;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed var(--panel-border);
            color: var(--text-sub);
            display: block;
        }

        .diff-panel {
            background: rgba(234, 179, 8, 0.1);
            border: 1px solid rgba(234, 179, 8, 0.2);
            padding: 8px 15px;
            border-radius: 8px;
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .diff-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9em;
            font-weight: 700;
            color: #eab308;
        }

        .diff-stats-row {
            display: flex;
            gap: 20px;
            align-items: center;
            font-size: 0.9em;
            color: var(--text-main);
        }

        .diff-val-item {
            display: flex;
            gap: 5px;
        }

        .diff-interpretation {
            font-size: 0.85em;
            color: var(--text-sub);
            margin-top: 2px;
            font-style: italic;
        }

        .formula-display {
            display: none;
        }

        .control-buttons {
            margin-top: 5px;
            margin-left: auto;
            margin-right: auto;
            width: 90%;
            max-width: 1000px;
        }

        .charts-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 5px auto 0 auto;
            width: 90%;
            max-width: 1000px;
            justify-content: center;
        }

        .chart-box {
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: 12px;
            padding: 15px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .chart-wrapper {
            position: relative;
            width: 100%;
            aspect-ratio: 16 / 9;
        }

        /* --- Single/Dual Mode Layout Adaptations --- */
        .mode-selector-container {
            background: var(--panel-bg);
            padding: 15px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            border: 1px solid var(--panel-border);
        }

        .mode-label {
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 10px;
        }

        .segmented-control {
            display: flex;
            background: var(--input-bg);
            border-radius: 8px;
            padding: 4px;
            gap: 4px;
        }

        .segmented-control .mode-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-radius: 6px;
            font-weight: 600;
            color: var(--text-sub);
            transition: all 0.3s ease;
        }

        .segmented-control input[type="radio"]:checked+.mode-btn {
            background: var(--accent-a);
            color: var(--btn-text);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .segmented-control input[type="radio"]:not(:checked)+.mode-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-main);
        }

        /* Theme Toggle styles */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
            color: var(--text-main);
        }
    </style>
</head>

<body>

    <button id="themeToggleBtn" class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ›æ·±/æ·ºè‰²æ¨¡å¼">
        <i class="fas fa-sun"></i>
    </button>

    <div class="container">
        <div id="reportArea">
            <h1 class="main-title">Weibull å¯é åº¦åˆ†æ</h1>
            <p style="text-align: center; color: #7f8c8d; margin-top: -20px; margin-bottom: 20px;">
                ğŸ’¡ æ”¯æ´å–®çµ„æˆ–é›™çµ„æ•¸æ“šåˆ†æèˆ‡æ¯”å°
            </p>

            <div class="row">
                <div class="col-left">
                    <div class="mode-selector-container">
                        <div class="mode-label">åˆ†ææ¨¡å¼ (Analysis Mode):</div>
                        <div class="segmented-control">
                            <input type="radio" name="analysisMode" value="single" id="modeSingle"
                                onclick="setAnalysisMode('single')">
                            <label for="modeSingle" class="mode-btn">å–®çµ„åˆ†æ (Single)</label>

                            <input type="radio" name="analysisMode" value="dual" id="modeDual" checked
                                onclick="setAnalysisMode('dual')">
                            <label for="modeDual" class="mode-btn">é›™çµ„æ¯”å° (Dual)</label>
                        </div>
                    </div>

                    <div class="dual-input-container">
                        <!-- çµ„åˆ¥ A -->
                        <div id="panelGroupA" class="group-panel group-a">
                            <div class="group-header group-a">çµ„åˆ¥ A</div>
                            <label>çµ„åˆ¥åç¨±:</label>
                            <input type="text" id="groupNameA" class="calc-input" placeholder="ä¾‹å¦‚: åŸå§‹è¨­è¨ˆ" value="çµ„åˆ¥ A">
                            <label>å£½å‘½ (t):</label>
                            <input type="number" id="tInputA" class="calc-input" placeholder="è¼¸å…¥å£½å‘½å¾ŒæŒ‰ Enter" step="any">
                            <label>ç‹€æ…‹:</label>
                            <select id="sInputA" class="calc-input">
                                <option value="F">å¤±æ•ˆ (Failure)</option>
                                <option value="S">å³è¨­é™ (Suspended)</option>
                            </select>
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; margin-top:5px;">
                                <button class="btn-add" onclick="showBatchInput('A')">æ‰¹æ¬¡è¼¸å…¥</button>
                                <button class="btn-demo" onclick="loadDemo('A')">ç¯„ä¾‹</button>
                            </div>
                            <button class="btn-clear" onclick="clearData('A')">æ¸…ç©º</button>

                            <div class="table-container">
                                <table id="dataTableA">
                                    <thead>
                                        <tr>
                                            <th>åºè™Ÿ</th>
                                            <th>å£½å‘½</th>
                                            <th>ç‹€æ…‹</th>
                                            <th>åˆªé™¤</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- çµ„åˆ¥ B -->
                        <div id="panelGroupB" class="group-panel group-b">
                            <div class="group-header group-b">çµ„åˆ¥ B</div>
                            <label>çµ„åˆ¥åç¨±:</label>
                            <input type="text" id="groupNameB" class="calc-input" placeholder="ä¾‹å¦‚: æ”¹è‰¯è¨­è¨ˆ" value="çµ„åˆ¥ B">
                            <label>å£½å‘½ (t):</label>
                            <input type="number" id="tInputB" class="calc-input" placeholder="è¼¸å…¥å£½å‘½å¾ŒæŒ‰ Enter" step="any">
                            <label>ç‹€æ…‹:</label>
                            <select id="sInputB" class="calc-input">
                                <option value="F">å¤±æ•ˆ (Failure)</option>
                                <option value="S">å³è¨­é™ (Suspended)</option>
                            </select>
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; margin-top:5px;">
                                <button class="btn-add-b" onclick="showBatchInput('B')">æ‰¹æ¬¡è¼¸å…¥</button>
                                <button class="btn-demo" onclick="loadDemo('B')">ç¯„ä¾‹</button>
                            </div>
                            <button class="btn-clear" onclick="clearData('B')">æ¸…ç©º</button>

                            <div class="table-container">
                                <table id="dataTableB">
                                    <thead>
                                        <tr>
                                            <th>åºè™Ÿ</th>
                                            <th>å£½å‘½</th>
                                            <th>ç‹€æ…‹</th>
                                            <th>åˆªé™¤</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-right">
                    <div id="resultPanel" class="result-panel">
                        <div
                            style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:8px; margin-bottom:10px;">
                            <h3 id="resultTitle" style="margin:0; font-size:1.1em;">åˆ†æçµæœ</h3>
                            <span style="font-family:'Times New Roman', serif; font-size:0.9em; color:#7f8c8d;">$$ R(t)
                                = e^{-(t/\eta)^\beta} $$</span>
                        </div>

                        <div class="comparison-grid">
                            <!-- Group A Card -->
                            <div class="group-result group-a">
                                <h4 style="color: #2980b9;">
                                    çµ„åˆ¥ A
                                    <span id="groupANameBadge" style="font-size:0.8em; opacity:0.7"></span>
                                </h4>
                                <div class="stat-row">
                                    <div class="stat-item">
                                        <span class="stat-label">Î²</span>
                                        <span class="stat-value" id="valBetaA" style="color: #2980b9;">-</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Î·</span>
                                        <span class="stat-value" id="valEtaA" style="color: #2980b9;">-</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">RÂ²</span>
                                        <span class="stat-value" id="valR2A" style="color: #2980b9;">-</span>
                                    </div>
                                </div>
                                <div id="descTextA" class="desc-text"></div>
                            </div>

                            <!-- Group B Card -->
                            <div class="group-result group-b">
                                <h4 style="color: #c0392b;">
                                    çµ„åˆ¥ B
                                    <span id="groupBNameBadge" style="font-size:0.8em; opacity:0.7"></span>
                                </h4>
                                <div class="stat-row">
                                    <div class="stat-item">
                                        <span class="stat-label">Î²</span>
                                        <span class="stat-value" id="valBetaB" style="color: #c0392b;">-</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Î·</span>
                                        <span class="stat-value" id="valEtaB" style="color: #c0392b;">-</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">RÂ²</span>
                                        <span class="stat-value" id="valR2B" style="color: #c0392b;">-</span>
                                    </div>
                                </div>
                                <div id="descTextB" class="desc-text"></div>
                            </div>
                        </div>

                        <div class="diff-panel" id="diffPanel" style="display:none;">
                            <div class="diff-header">
                                <span>ğŸ“Š å·®ç•°åˆ†æ (B vs A)</span>
                            </div>
                            <div class="diff-stats-row">
                                <div class="diff-val-item"><strong>Beta:</strong> <span id="diffBeta">-</span></div>
                                <div class="diff-val-item"><strong>Eta:</strong> <span id="diffEta">-</span></div>
                                <div class="diff-val-item"><strong>æ”¹å–„ç‡:</strong> <span id="diffImprovement">-</span>
                                </div>
                            </div>
                            <div id="diffInterpretation" class="diff-interpretation"></div>
                        </div>
                    </div>
                    <div class="control-buttons">

                        <div class="export-grid-six">
                            <button id="btnRunAnalysis" class="btn-calc btn-uniform" onclick="runAnalysis()"
                                style="width: auto; padding: 10px 20px;">ğŸ” é–‹å§‹åˆ†æ</button>
                            <button class="btn-export btn-uniform" onclick="exportData()">ğŸ“Š æ•¸æ“šåŒ¯å‡º</button>
                            <button class="btn-report btn-uniform" onclick="generateReport()">ğŸ“„ ç”¢ç”Ÿå ±å‘Š</button>
                            <button class="btn-clear-all btn-uniform" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨</button>
                            <button class="btn-theory btn-uniform" onclick="openTheory()">ğŸ“˜ ç†è«–æŒ‡å—</button>
                        </div>
                    </div>

                    <div class="charts-container">
                        <div class="chart-box">
                            <h4 style="text-align:center; margin-bottom:10px; color:#555;">æ©Ÿç‡åœ– (Probability Plot)</h4>
                            <div class="chart-wrapper">
                                <div id="chartProb"></div>
                            </div>
                        </div>
                        <div class="chart-box">
                            <!-- Header Row with Input -->
                            <div
                                style="display:flex; justify-content:center; align-items:center; gap:15px; margin-bottom:10px;">
                                <h4 style="text-align:center; margin:0; color:#555;">å¯é åº¦åœ– (Reliability Plot)</h4>

                                <div
                                    style="display:flex; align-items:center; gap:8px; background:#f8f9fa; padding:4px 12px; border-radius:20px; border:1px solid #eee;">
                                    <label for="markerRInput"
                                        style="font-size:0.9em; font-weight:bold; color:#555; margin:0;">æ¨™ç¤ºå¯é åº¦
                                        R(%)</label>
                                    <input type="number" id="markerRInput" class="calc-input" value="95" min="0.1"
                                        max="99.9" step="0.1"
                                        style="width:70px; padding:2px 6px; border:1px solid #ccc; border-radius:4px; text-align:center; font-size:0.95em;">
                                </div>
                            </div>
                            <div class="chart-wrapper">
                                <div id="chartRel"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ–°å¢åœ–è¡¨ä¸¦åˆ—å€åŸŸ -->
            <!-- Charts moved up -->
        </div>

        <!-- æ‰¹æ¬¡è¼¸å…¥å½ˆå‡ºè¦–çª— -->
        <div id="batchModal" class="batch-modal">
            <div class="batch-modal-content">
                <div class="batch-modal-header" id="batchModalTitle">ğŸ“‹ æ‰¹æ¬¡è¼¸å…¥æ•¸æ“š</div>
                <div class="batch-help">
                    <strong>ä½¿ç”¨èªªæ˜ï¼š</strong><br>
                    â€¢ å¾ Excel æˆ– CSV è¤‡è£½æ•¸æ“šï¼Œç›´æ¥è²¼ä¸Šåˆ°ä¸‹æ–¹æ–‡å­—æ¡†<br>
                    â€¢ æ ¼å¼ï¼šæ¯è¡Œä¸€ç­†æ•¸æ“šï¼Œç”¨ Tabã€é€—è™Ÿæˆ–ç©ºæ ¼åˆ†éš”<br>
                    â€¢ ç¬¬ä¸€æ¬„ï¼šå£½å‘½ (t)ï¼Œç¬¬äºŒæ¬„ï¼šç‹€æ…‹ (F=å¤±æ•ˆ, S=å³è¨­é™)<br>
                    â€¢ ç¯„ä¾‹ï¼š<code>100 F</code> æˆ– <code>200,S</code> æˆ– <code>300	F</code>
                </div>
                <textarea id="batchTextarea" class="batch-textarea"
                    placeholder="è«‹è²¼ä¸Šæ•¸æ“šï¼Œä¾‹å¦‚ï¼š&#10;100 F&#10;150 F&#10;200 S&#10;250 F"></textarea>
                <div class="batch-buttons">
                    <button class="btn-add" onclick="processBatchInput()">âœ“ ç¢ºèªåŠ å…¥</button>
                    <button class="btn-clear" onclick="closeBatchInput()">âœ— å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <div id="theoryModal" class="batch-modal">
            <div class="batch-modal-content" style="max-width: 900px;">
                <div class="batch-modal-header">ğŸ“˜ Weibull åˆ†æç†è«–æŒ‡å—</div>
                <div style="max-height: 70vh; overflow-y: auto;">
                    <h2>1. æ•¸æ“šé¡å‹ï¼šå¤±æ•ˆèˆ‡å³è¨­é™</h2>
                    <p>åœ¨å¯é åº¦æ¸¬è©¦ä¸­ï¼Œæˆ‘å€‘æœƒé‡åˆ°å…©ç¨®æ•¸æ“šé¡å‹ï¼š</p>

                    <h3>å¤±æ•ˆæ•¸æ“š (Failure, F)</h3>
                    <p>ç”¢å“åœ¨æ¸¬è©¦æœŸé–“<strong class="highlight-text">ç¢ºå¯¦ç™¼ç”Ÿå¤±æ•ˆ</strong>çš„æ•¸æ“šé»ã€‚ä¾‹å¦‚ï¼šç”¢å“åœ¨é‹ä½œ 300 å°æ™‚å¾Œæå£ã€‚é€™æ˜¯æœ€ç›´æ¥ã€æœ€æœ‰åƒ¹å€¼çš„æ•¸æ“šã€‚
                    </p>

                    <h3>å³è¨­é™æ•¸æ“š (Suspended/Censored, S)</h3>
                    <p><strong>å³è¨­é™</strong>æ˜¯æŒ‡ç”¢å“åœ¨æ¸¬è©¦çµæŸæ™‚<strong
                            class="highlight-text">ä»ç„¶æ­£å¸¸é‹ä½œ</strong>ï¼Œæˆ‘å€‘åªçŸ¥é“å®ƒã€Œè‡³å°‘ã€å­˜æ´»äº†é€™éº¼ä¹…ï¼Œä½†ä¸çŸ¥é“å¯¦éš›å£½å‘½ã€‚</p>

                    <div class="calculation-example" style="background-color: #fff3e0; border-color: #ffb74d;">
                        <h3>ç‚ºä»€éº¼æœƒæœ‰å³è¨­é™æ•¸æ“šï¼Ÿ</h3>
                        <ul>
                            <li><strong>æ¸¬è©¦æ™‚é–“é™åˆ¶ï¼š</strong>ç”¢å“æ¸¬è©¦ 500 å°æ™‚å¾ŒçµæŸï¼Œä½†æœ‰äº›æ¨£å“é‚„æ²’å£ â†’ è¨˜éŒ„ç‚ºã€Œ500 å°æ™‚ï¼Œè¨­é™ (S)ã€</li>
                            <li><strong>æ¨£å“ç§»é™¤ï¼š</strong>æ¸¬è©¦ä¸­é€”å› å…¶ä»–åŸå› ï¼ˆéå¤±æ•ˆï¼‰ç§»é™¤æ¨£å“ï¼Œä¾‹å¦‚é€å»åšå…¶ä»–æª¢æ¸¬</li>
                            <li><strong>æˆæœ¬è€ƒé‡ï¼š</strong>é•·æ™‚é–“æ¸¬è©¦æˆæœ¬é«˜ï¼Œç„¡æ³•ç­‰åˆ°æ‰€æœ‰æ¨£å“éƒ½å¤±æ•ˆ</li>
                        </ul>
                        <p><strong class="highlight-text">é‡è¦ï¼š</strong>å³è¨­é™æ•¸æ“šé›–ç„¶æ²’æœ‰å¤±æ•ˆï¼Œä½†ä»ç„¶æä¾›äº†ã€Œç”¢å“è‡³å°‘èƒ½æ´»é€™éº¼ä¹…ã€çš„è³‡è¨Šï¼Œå°æ–¼æå‡åˆ†ææº–ç¢ºåº¦éå¸¸æœ‰å¹«åŠ©ï¼
                        </p>
                    </div>

                    <h3>å¯¦éš›ç¯„ä¾‹</h3>
                    <p>å‡è¨­æ¸¬è©¦ 5 å€‹ç”¢å“ï¼Œæ¸¬è©¦æ™‚é–“ä¸Šé™ 600 å°æ™‚ï¼š</p>
                    <ul>
                        <li>ç”¢å“ Aï¼š300 å°æ™‚å¤±æ•ˆ â†’ <strong>300, F</strong></li>
                        <li>ç”¢å“ Bï¼š450 å°æ™‚å¤±æ•ˆ â†’ <strong>450, F</strong></li>
                        <li>ç”¢å“ Cï¼š600 å°æ™‚ä»æ­£å¸¸ â†’ <strong>600, S</strong> (å³è¨­é™)</li>
                        <li>ç”¢å“ Dï¼š550 å°æ™‚å¤±æ•ˆ â†’ <strong>550, F</strong></li>
                        <li>ç”¢å“ Eï¼š600 å°æ™‚ä»æ­£å¸¸ â†’ <strong>600, S</strong> (å³è¨­é™)</li>
                    </ul>
                    <p>é€™æ¨£çš„æ•¸æ“šçµ„åˆå¯ä»¥é€²è¡Œ Weibull åˆ†æï¼Œå³è¨­é™æ•¸æ“šæœƒè¢«æ­£ç¢ºç´å…¥è¨ˆç®—ã€‚</p>

                    <!-- æ–°å¢å€å¡Šï¼šR(t) èˆ‡ F(t) çš„é—œä¿‚ -->
                    <h2>1.5 å¯é åº¦èˆ‡ä¸å¯é åº¦çš„é—œä¿‚</h2>
                    <p>åœ¨å·¥ç¨‹å¯¦å‹™ä¸­ï¼Œç”¢å“çš„ç‹€æ…‹æ˜¯ä¸€é«”å…©é¢çš„ï¼šä¸æ˜¯ã€Œå­˜æ´»ã€å°±æ˜¯ã€Œå·²å¤±æ•ˆã€ã€‚å› æ­¤æˆ‘å€‘å®šç¾©äº†äº’è£œçš„å…©å€‹æŒ‡æ¨™ï¼š</p>

                    <ul>
                        <li><strong>\(R(t)\) å¯é åº¦ (Reliability)</strong>ï¼š
                            <br>é€šä¿—åç¨±ï¼š<strong class="highlight-text">å­˜æ´»ç‡ (Survival Rate)</strong>
                            <br>å®šç¾©ï¼šä»£è¡¨ç”¢å“é‹ä½œåˆ°æ™‚é–“ \(t\) <strong>ä»æœªæå£</strong>çš„æ©Ÿç‡ã€‚
                        </li>
                        <li style="margin-top: 10px;"><strong>\(F(t)\) ä¸å¯é åº¦ (Unreliability)</strong>ï¼š
                            <br>é€šä¿—åç¨±ï¼š<strong class="highlight-text">ç´¯ç©å¤±æ•ˆæ©Ÿç‡ (Cumulative Probability of
                                Failure)</strong>
                            <br>å®šç¾©ï¼šä»£è¡¨ç”¢å“å¾é–‹å§‹é‹ä½œç›´åˆ°æ™‚é–“ \(t\) <strong>å·²ç¶“æå£</strong>çš„ç¸½æ¯”ä¾‹ï¼ˆå³ CDFï¼‰ã€‚
                        </li>
                    </ul>

                    <div class="formula-box">
                        $$ R(t) + F(t) = 1 $$
                        <p style="font-size: 0.8em; color: #555; margin-top: 5px;">(å­˜æ´»ç‡) + (ç´¯ç©å¤±æ•ˆæ©Ÿç‡) = 100%</p>
                    </div>

                    <h2>2. æ ¸å¿ƒå…¬å¼</h2>
                    <p>Weibull åˆ†ä½ˆçš„ <strong class="highlight-text">å¯é åº¦å‡½æ•¸ (Reliability Function) \(R(t)\)</strong>
                        å…¬å¼å¦‚ä¸‹ï¼š</p>

                    <div class="formula-box">
                        $$ R(t) = e^{-(t/\eta)^\beta} $$
                    </div>

                    <ul>
                        <li><strong>\(t\)</strong>ï¼šå£½å‘½ï¼ˆæˆ–è¡Œé§›é‡Œç¨‹ã€å¾ªç’°æ¬¡æ•¸ï¼‰ã€‚</li>
                        <li><strong>\(R(t)\)</strong>ï¼šåœ¨æ™‚é–“ \(t\) æ™‚ï¼Œç”¢å“å°šæœªå¤±æ•ˆçš„æ©Ÿç‡ï¼ˆå¯é åº¦ï¼‰ã€‚</li>
                        <li><strong>\(\beta\) (Beta)</strong>ï¼šå½¢ç‹€åƒæ•¸ (Shape Parameter)ï¼Œæ±ºå®šå¤±æ•ˆæ¨¡å¼ã€‚</li>
                        <li><strong>\(\eta\) (Eta)</strong>ï¼šå°ºåº¦åƒæ•¸ (Scale Parameter)ï¼Œåˆç¨±ç‰¹å¾µå£½å‘½ã€‚</li>
                    </ul>

                    <h2>3. ç†è§£é—œéµåƒæ•¸</h2>
                    <p>åœ¨ä»£å…¥å…¬å¼å‰ï¼Œå¿…é ˆå…ˆé€éæ•¸æ“šæ“¬åˆæ±‚å‡º \(\beta\) å’Œ \(\eta\)ã€‚</p>

                    <h3>\(\beta\) (å½¢ç‹€åƒæ•¸)ï¼šæ±ºå®šå¤±æ•ˆé¡å‹</h3>
                    <ul>
                        <li><strong>\(\beta < 1\)</strong>ï¼šæ—©æœŸå¤±æ•ˆæœŸ (Infant Mortality)ã€‚ç”¢å“å‰›å‡ºå» å°±å£ï¼Œé€šå¸¸æ˜¯ç”Ÿç”¢ç‘•ç–µã€‚</li>
                        <li><strong>\(\beta = 1\)</strong>ï¼šéš¨æ©Ÿå¤±æ•ˆæœŸ (Random Failures)ã€‚å¤±æ•ˆå¾‹æ˜¯å¸¸æ•¸ï¼Œé¡ä¼¼æŒ‡æ•¸åˆ†ä½ˆã€‚</li>
                        <li><strong>\(\beta > 1\)</strong>ï¼šç£¨è€—å¤±æ•ˆæœŸ (Wear-out)ã€‚ç”¢å“è€åŒ–ã€ç–²å‹ï¼Œå¤±æ•ˆå¾‹éš¨æ™‚é–“ä¸Šå‡ã€‚</li>
                    </ul>

                    <h3>\(\eta\) (å°ºåº¦åƒæ•¸)ï¼šç‰¹å¾µå£½å‘½</h3>
                    <p>ä»£è¡¨ç•¶ <strong>63.2%</strong> çš„ç”¢å“å·²ç¶“å¤±æ•ˆæ™‚çš„æ™‚é–“é»ï¼ˆæ­¤æ™‚ \(R(t) = 36.8\%\)ï¼‰ã€‚é€™æ˜¯è¡¡é‡ç”¢å“å£½å‘½é•·çŸ­çš„ä¸»è¦æŒ‡æ¨™ã€‚</p>

                    <h3>\(R^2\) (æ“¬åˆåº¦)ï¼šæ•¸æ“šå¯ä¿¡åº¦æŒ‡æ¨™</h3>
                    <p><strong>æ“¬åˆåº¦ (R-squared, RÂ²)</strong> æ˜¯ç”¨ä¾†è©•ä¼° Weibull æ¨¡å‹èˆ‡å¯¦éš›æ•¸æ“šçš„å»åˆç¨‹åº¦ï¼Œæ•¸å€¼ç¯„åœç‚º 0 åˆ° 1ã€‚</p>
                    <ul>
                        <li><strong>\(R^2 \geq 0.95\)</strong>ï¼šå„ªç§€æ“¬åˆï¼Œæ•¸æ“šéå¸¸ç¬¦åˆ Weibull åˆ†ä½ˆï¼Œåˆ†æçµæœé«˜åº¦å¯ä¿¡ã€‚</li>
                        <li><strong>\(0.90 \leq R^2 < 0.95\)</strong>ï¼šè‰¯å¥½æ“¬åˆï¼Œçµæœå¯æ¥å—ï¼Œä½†å¯èƒ½å­˜åœ¨å°‘é‡ç•°å¸¸æ•¸æ“šã€‚</li>
                        <li><strong>\(0.80 \leq R^2 < 0.90\)</strong>ï¼šå°šå¯æ“¬åˆï¼Œå»ºè­°æª¢æŸ¥æ•¸æ“šå“è³ªæˆ–è€ƒæ…®å…¶ä»–åˆ†ä½ˆæ¨¡å‹ã€‚</li>
                        <li><strong>\(R^2 < 0.80\)</strong>ï¼šæ“¬åˆä¸ä½³ï¼Œæ•¸æ“šå¯èƒ½ä¸ç¬¦åˆ Weibull åˆ†ä½ˆï¼Œæˆ–å­˜åœ¨åš´é‡ç•°å¸¸å€¼ã€‚</li>
                    </ul>
                    <p><strong class="highlight-text">æ³¨æ„ï¼š</strong>å¦‚æœ \(R^2\)
                        éä½ï¼Œå»ºè­°é‡æ–°æª¢è¦–æ•¸æ“šä¾†æºã€æ¸¬è©¦æ¢ä»¶æ˜¯å¦ä¸€è‡´ï¼Œæˆ–è€ƒæ…®ä½¿ç”¨å°æ•¸å¸¸æ…‹åˆ†ä½ˆç­‰å…¶ä»–æ¨¡å‹ã€‚</p>

                    <h2>4. è¨ˆç®—æ­¥é©Ÿå¯¦ä¾‹</h2>
                    <p>å‡è¨­ä½ åˆ†æä¸€çµ„æ•¸æ“šå¾Œå¾—åˆ°åƒæ•¸ï¼š<strong class="highlight-text">\(\beta = 2.5\)</strong> (ç£¨è€—å‹) èˆ‡ <strong
                            class="highlight-text">\(\eta = 1000\) å°æ™‚</strong>ã€‚</p>

                    <div class="calculation-example">
                        <h3>æƒ…å¢ƒ Aï¼šè¨ˆç®—ç‰¹å®šæ™‚é–“çš„å¯é åº¦</h3>
                        <p><strong>å•é¡Œï¼š</strong>ç”¢å“é‹ä½œ <strong>500 å°æ™‚</strong> å¾Œï¼Œé‚„å­˜æ´»çš„æ©Ÿç‡æ˜¯å¤šå°‘ï¼Ÿ</p>
                        <p>ä»£å…¥å…¬å¼ï¼š</p>
                        $$ R(500) = e^{-(500/1000)^{2.5}} $$
                        $$ R(500) = e^{-(0.5)^{2.5}} = e^{-0.1768} \approx 0.838 $$
                        <p><strong>ç­”æ¡ˆï¼š</strong> å¯é åº¦ç‚º <strong>83.8%</strong>ã€‚</p>
                    </div>
                    <br>
                    <div class="calculation-example" style="background-color: #fff8e1; border-color: #ffe082;">
                        <h3>æƒ…å¢ƒ Bï¼šè¨ˆç®— B10 å£½å‘½ (B10 Life)</h3>
                        <p><strong>å•é¡Œï¼š</strong>å¤šå°‘æ™‚é–“å¾Œï¼Œæœƒæœ‰ 10% çš„ç”¢å“å¤±æ•ˆï¼ˆå³ 90% å¯é åº¦ï¼‰ï¼Ÿ</p>
                        <p>å…¬å¼è®Šå½¢ï¼š \( t = \eta \times (-\ln(R))^{1/\beta} \)</p>
                        $$ t = 1000 \times (-\ln(0.9))^{1/2.5} $$
                        $$ t = 1000 \times (0.10536)^{0.4} $$
                        $$ t \approx 1000 \times 0.406 = 406 \text{ å°æ™‚} $$
                        <p><strong>ç­”æ¡ˆï¼š</strong> B10 å£½å‘½ç‚º <strong>406 å°æ™‚</strong>ã€‚</p>
                    </div>

                    <h2>4. B-Life æ¦‚å¿µèˆ‡å·¥ç¨‹æ„ç¾©</h2>
                    <p>åœ¨å¯é åº¦å·¥ç¨‹ï¼ˆç‰¹åˆ¥æ˜¯ Weibull åˆ†æï¼‰ä¸­ï¼Œã€ŒBã€ ä»£è¡¨ Basic Lifeï¼ˆåŸºæœ¬å£½å‘½ï¼‰ï¼Œå¾Œé¢çš„æ•¸å­—ä»£è¡¨ ç´¯ç©å¤±æ•ˆç™¾åˆ†æ¯”ã€‚ç°¡å–®ä¾†èªªï¼ŒBx å£½å‘½å°±æ˜¯ï¼šã€Œç•¶ x%
                        çš„ç”¢å“å¤±æ•ˆæ™‚ï¼Œæ‰€ç¶“éçš„æ™‚é–“ã€ã€‚ä»¥ä¸‹æ˜¯ B1ã€B10ã€B63.2 çš„è©³ç´°å®šç¾©èˆ‡å®ƒå€‘åœ¨å·¥ç¨‹ä¸Šçš„æ„ç¾©ï¼š</p>

                    <h3>1. B10 å£½å‘½ (B10 Life) â€”â€” è¡Œæ¥­é€šç”¨æ¨™æº–</h3>
                    <div class="calculation-example" style="background-color: #e8f8f5; border-color: #2ecc71;">
                        <p><strong>å®šç¾©ï¼š</strong>ç•¶ 10% çš„ç”¢å“å¤±æ•ˆï¼ˆä¹Ÿå°±æ˜¯é‚„æœ‰ 90% å­˜æ´»ï¼‰çš„æ™‚é–“é»ã€‚</p>
                        <p><strong>æ•¸å­¸æ„ç¾©ï¼š</strong>å¯é åº¦ \(R(t) = 90\%\) æˆ– \(0.9\)ã€‚</p>
                        <p><strong>æ‡‰ç”¨å ´æ™¯ï¼š</strong>é€™æ˜¯æ±½è»Šæ¥­ã€è»¸æ‰¿æ¥­ã€é¦¬é”æ¥­æœ€å¸¸ç”¨çš„æŒ‡æ¨™ã€‚é€šå¸¸ç”¨ä¾†è¨­å®š <strong>ä¿å›ºæœŸ (Warranty)</strong>ã€‚</p>
                        <p><strong>å¯¦éš›ä¾‹å­ï¼š</strong>å¦‚æœè»Šå» ç®—å‡ºæŸé›¶ä»¶çš„ B10 å£½å‘½æ˜¯ 3å¹´ï¼Œä»£è¡¨ 3å¹´å…§é è¨ˆæœƒæœ‰ 10% çš„è»Šå›ä¾†ç¶­ä¿®ï¼Œé€™æœ‰åŠ©æ–¼è¨ˆç®—ä¿å›ºæˆæœ¬ã€‚</p>
                    </div>

                    <h3>2. B1 å£½å‘½ (B1 Life) â€”â€” é«˜å®‰å…¨æ¨™æº–</h3>
                    <div class="calculation-example" style="background-color: #f8f9fa; border-color: #495057;">
                        <p><strong>å®šç¾©ï¼š</strong>ç•¶ 1% çš„ç”¢å“å¤±æ•ˆï¼ˆä¹Ÿå°±æ˜¯é‚„æœ‰ 99% å­˜æ´»ï¼‰çš„æ™‚é–“é»ã€‚</p>
                        <p><strong>æ•¸å­¸æ„ç¾©ï¼š</strong>å¯é åº¦ \(R(t) = 99\%\) æˆ– \(0.99\)ã€‚</p>
                        <p><strong>æ‡‰ç”¨å ´æ™¯ï¼š</strong>ç”¨æ–¼é«˜å®‰å…¨æ€§ã€é«˜å¯é åº¦çš„ç”¢å“ï¼Œå¦‚ <strong>èˆªå¤ªã€é†«ç™‚è¨­å‚™ã€æ±½è»Šå®‰å…¨æ°£å›Š</strong>ã€‚å°æ–¼é€™äº›ç”¢å“ï¼Œ10%
                            çš„å¤±æ•ˆæ˜¯ä¸å¯æ¥å—çš„ï¼Œå¿…é ˆç¢ºä¿æ¥µå°‘é‡çš„ç”¢å“æœƒåœ¨è©²æ™‚é–“é»å‰å£æ‰ã€‚</p>
                    </div>

                    <h3>3. B63.2 (ç‰¹å¾µå£½å‘½ / \(\eta\)) â€”â€” æ•¸å­¸åŸºæº–</h3>
                    <div class="calculation-example" style="background-color: #fff3cd; border-color: #ffc107;">
                        <p><strong>å®šç¾©ï¼š</strong>ç•¶ 63.2% çš„ç”¢å“å¤±æ•ˆï¼ˆåªå‰© 36.8% å­˜æ´»ï¼‰çš„æ™‚é–“é»ã€‚</p>
                        <p><strong>ç‚ºä»€éº¼æ˜¯ 63.2%ï¼Ÿ</strong>é€™ä¾†è‡ª Weibull çš„å…¬å¼çµæ§‹ã€‚ç•¶æ™‚é–“ \(t\) æ­£å¥½ç­‰æ–¼å°ºåº¦åƒæ•¸ \(\eta\) æ™‚ï¼š</p>
                        <div class="formula-box">
                            $$ R(\eta) = e^{-(\eta/\eta)^\beta} = e^{-1} \approx 0.3678 $$
                            $$ F(t) = 1 - 0.3678 = 0.6322 \text{ (å³ 63.2%)} $$
                        </div>
                        <p><strong>æ„ç¾©ï¼š</strong>B63.2 å°±æ˜¯ \(\eta\) (Eta, å°ºåº¦åƒæ•¸)ã€‚å®ƒä»£è¡¨é€™æ‰¹ç”¢å“çš„ã€Œç‰¹å¾µå£½å‘½ã€(Characteristic Life)ã€‚é›–ç„¶
                            63% çš„å¤±æ•ˆç‡è½èµ·ä¾†å¾ˆé«˜ï¼ˆå¤§åŠéƒ½å£äº†ï¼‰ï¼Œä½†å®ƒåœ¨æ•¸å­¸ä¸Šæ˜¯ä¸€å€‹éå¸¸ç©©å®šçš„åŸºæº–ç‚¹ï¼Œç”¨ä¾†è¡¡é‡æ•´é«”å£½å‘½çš„é•·çŸ­ã€‚å¦‚æœ \(\eta\) è¶Šå¤§ï¼Œä»£è¡¨ç”¢å“æ•´é«”æ’å¾—è¶Šä¹…ã€‚</p>
                    </div>

                    <h3>ç¸½çµæ¯”è¼ƒè¡¨</h3>
                    <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                        <thead>
                            <tr style="background-color: #34495e; color: white;">
                                <th style="padding: 12px; border: 1px solid #ddd;">æŒ‡æ¨™</th>
                                <th style="padding: 12px; border: 1px solid #ddd;">å¤±æ•ˆæ¯”ä¾‹</th>
                                <th style="padding: 12px; border: 1px solid #ddd;">å­˜æ´»ç‡ (å¯é åº¦)</th>
                                <th style="padding: 12px; border: 1px solid #ddd;">æ„ç¾©èˆ‡ç”¨é€”</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background-color: #ffebee;">
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">
                                    <strong>B1</strong>
                                </td>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">1%</td>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">99%</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">æ¥µä½é¢¨éšªï¼šç”¨æ–¼é£›æ©Ÿã€é†«ç™‚ã€å®‰å…¨ä»¶ã€‚</td>
                            </tr>
                            <tr style="background-color: #e8f5e9;">
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">
                                    <strong>B10</strong>
                                </td>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">10%</td>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">90%</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">å·¥æ¥­æ¨™æº–ï¼šç”¨æ–¼åˆ¶å®šä¿å›ºæœŸã€é¦¬é”å£½å‘½ã€ä¸€èˆ¬é›»å­ç”¢å“ã€‚</td>
                            </tr>
                            <tr style="background-color: #f3e5f5;">
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">
                                    <strong>B50</strong>
                                </td>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">50%</td>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">50%</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">ä¸­ä½æ•¸å£½å‘½ï¼šä¸€åŠå£äº†ä¸€åŠå¥½çš„æ™‚é–“é» (å¹³å‡å£½å‘½)ã€‚</td>
                            </tr>
                            <tr style="background-color: #fff3e0;">
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">
                                    <strong>B63.2</strong>
                                </td>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">63.2%</td>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">36.8%</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">ç‰¹å¾µå£½å‘½ (\(\eta\))ï¼šWeibull
                                    çš„å°ºåº¦åƒæ•¸ï¼Œæ•¸å­¸ä¸Šçš„åŸºæº–é»ã€‚</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>å¦‚ä½•é€éæˆ‘å€‘å‰›åšçš„ç¶²é è¨ˆç®—ï¼Ÿ</h3>
                    <div class="calculation-example" style="background-color: #e3f2fd; border-color: #2196f3;">
                        <p>åœ¨æˆ‘å€‘çš„ç¶²é å·¥å…·ç®—å‡º \(\beta\) å’Œ \(\eta\) å¾Œï¼Œæ‚¨å¯ä»¥æ‰‹å‹•ç”¨ä»¥ä¸‹å…¬å¼åæ¨é€™äº› B-Lifeï¼š</p>
                        <div class="formula-box">
                            $$ t = \eta \times (-\ln(R))^{1/\beta} $$
                        </div>
                        <ul>
                            <li><strong>ç®— B1ï¼š</strong>å°‡ R è¨­ç‚º 0.99</li>
                            <li><strong>ç®— B10ï¼š</strong>å°‡ R è¨­ç‚º 0.90</li>
                            <li><strong>ç®— B63.2ï¼š</strong>ç­”æ¡ˆå°±æ˜¯ç¶²é ä¸Šé¡¯ç¤ºçš„ Eta (\(\eta\)) å€¼ã€‚</li>
                        </ul>
                    </div>

                    <h2>5. æ¨£æœ¬æ•¸é‡å»ºè­°ï¼šå¤šå°‘é¡†æ‰å¤ ï¼Ÿ</h2>
                    <p>é€²è¡Œå¯é åº¦åˆ†æï¼ˆç‰¹åˆ¥æ˜¯ Weibull åˆ†æï¼‰æ™‚ï¼Œæ¨£æœ¬æ•¸é‡çš„é¸æ“‡æ°¸é æ˜¯<strong
                            class="highlight-text">ã€Œçµ±è¨ˆç²¾ç¢ºåº¦ã€èˆ‡ã€Œæ¸¬è©¦æˆæœ¬/æ™‚é–“ã€ä¹‹é–“çš„æ¬Šè¡¡</strong>ã€‚é›–ç„¶æ•¸å­¸ä¸Šåªéœ€è¦ <strong>2
                            å€‹å¤±æ•ˆé»</strong>å°±èƒ½ç•«å‡ºä¸€æ¢ç·šï¼ˆæ±‚å‡º \(\beta\) å’Œ \(\eta\)ï¼‰ï¼Œä½†åœ¨å·¥ç¨‹å¯¦å‹™ä¸Šï¼Œé€™æ˜¯é é ä¸å¤ çš„ã€‚</p>

                    <h3>å»ºè­°çš„æ¨£æœ¬æ•¸é‡ (Rule of Thumb)</h3>
                    <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                        <thead>
                            <tr style="background-color: #34495e; color: white;">
                                <th style="padding: 12px; border: 1px solid #ddd;">æ¨£æœ¬æ•¸é‡</th>
                                <th style="padding: 12px; border: 1px solid #ddd;">è©•åƒ¹</th>
                                <th style="padding: 12px; border: 1px solid #ddd;">é©ç”¨æƒ…å¢ƒ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;"><strong>3 - 5
                                        é¡†</strong></td>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; color: #e74c3c;">
                                    <strong>æ¥µä½ (é«˜é¢¨éšª)</strong>
                                </td>
                                <td style="padding: 10px; border: 1px solid #ddd;">
                                    åƒ…é©ç”¨æ–¼éå¸¸æ˜‚è²´çš„ç”¢å“ï¼ˆå¦‚è¡›æ˜Ÿã€å¤§å‹æ¨¡å…·ï¼‰æˆ–åˆæ­¥æ‘¸åº•æ¸¬è©¦ã€‚èª¤å·®ç¯„åœæ¥µå¤§ï¼Œåƒ…èƒ½çœ‹å¤§è‡´è¶¨å‹¢ã€‚</td>
                            </tr>
                            <tr style="background-color: #f9f9f9;">
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;"><strong>6 -
                                        10 é¡†</strong></td>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; color: #f39c12;">
                                    <strong>å‹‰å¼·æ¥å—</strong>
                                </td>
                                <td style="padding: 10px; border: 1px solid #ddd;">é©ç”¨æ–¼é–‹ç™¼éšæ®µçš„å¿«é€Ÿé©—è­‰ã€‚å¯ä»¥ç®—å‡ºåƒæ•¸ï¼Œä½†å°æ–¼ B10
                                    å£½å‘½ï¼ˆæ—©æœŸå¤±æ•ˆï¼‰çš„é æ¸¬ä»ä¸å¤ æº–ç¢ºã€‚</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;"><strong>10 -
                                        20 é¡†</strong></td>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; color: #27ae60;">
                                    <strong>å·¥ç¨‹æ¨è–¦ (ç”œèœœé»)</strong>
                                </td>
                                <td style="padding: 10px; border: 1px solid #ddd;">
                                    å¤§å¤šæ•¸å·¥æ¥­æ¨™æº–çš„é¸æ“‡ã€‚åœ¨æˆæœ¬èˆ‡ç²¾ç¢ºåº¦ä¹‹é–“å–å¾—æœ€ä½³å¹³è¡¡ï¼Œè¶³ä»¥åˆ¤æ–·å¤±æ•ˆæ¨¡å¼ (\(\beta\)) ä¸¦ä¼°ç®— B10 å£½å‘½ã€‚</td>
                            </tr>
                            <tr style="background-color: #f9f9f9;">
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;"><strong>20 -
                                        30 é¡†+</strong></td>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; color: #2980b9;">
                                    <strong>çµ±è¨ˆé¡¯è‘—</strong>
                                </td>
                                <td style="padding: 10px; border: 1px solid #ddd;">
                                    é©ç”¨æ–¼é«˜å¯é åº¦è¦æ±‚ï¼ˆå¦‚è»Šè¦ã€é†«ç™‚ã€èˆªå¤ªï¼‰æˆ–ä½æˆæœ¬å…ƒä»¶ã€‚èƒ½æä¾›è¼ƒçª„çš„ä¿¡è³´å€é–“ã€‚</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>ç‚ºä»€éº¼ï¼Ÿ(èƒŒå¾Œçš„çµ±è¨ˆåŸå› )</h3>

                    <div class="calculation-example" style="background-color: #e8f5e9; border-color: #81c784;">
                        <h3>A. ä¿¡è³´å€é–“ (Confidence Bounds) çš„å¯¬åº¦</h3>
                        <p>Weibull åˆ†æç®—å‡ºçš„åªæ˜¯ã€Œä¼°è¨ˆå€¼ã€ã€‚æ¨£æœ¬è¶Šå°‘ï¼Œä¸ç¢ºå®šæ€§ï¼ˆä¿¡è³´å€é–“ï¼‰å°±è¶Šå¯¬ã€‚</p>
                        <p><strong>ä¾‹å­ï¼š</strong></p>
                        <ul>
                            <li><strong>5 é¡†æ¨£å“ï¼š</strong>ç®—å‡º B10 å£½å‘½æ˜¯ 500 å°æ™‚ï¼Œä½† 90% ä¿¡è³´å€é–“å¯èƒ½æ˜¯ <strong>[100 å°æ™‚, 2500
                                    å°æ™‚]</strong>ã€‚é€™ç¯„åœå¤§åˆ°å¹¾ä¹ç„¡æ³•åšæ±ºç­–ã€‚</li>
                            <li><strong>20 é¡†æ¨£å“ï¼š</strong>ç®—å‡º B10 å£½å‘½æ˜¯ 500 å°æ™‚ï¼Œä¿¡è³´å€é–“å¯èƒ½ç¸®å°è‡³ <strong>[400 å°æ™‚, 650
                                    å°æ™‚]</strong>ã€‚é€™æ•¸æ“šå°±å¾ˆæœ‰åƒè€ƒåƒ¹å€¼ã€‚</li>
                        </ul>
                    </div>

                    <div class="calculation-example" style="background-color: #fff3e0; border-color: #ffb74d;">
                        <h3>B. ç‚ºäº†æŠ“åˆ°ã€Œæ—©æœŸå¤±æ•ˆã€(B1/B10)</h3>
                        <p>å·¥ç¨‹å¸«é€šå¸¸ä¸é—œå¿ƒå¹³å‡å£½å‘½ (\(\eta\), B63.2)ï¼Œè€Œæ˜¯é—œå¿ƒ<strong class="highlight-text">ã€Œæœ€æ—©å£çš„é‚£å¹¾é¡†ã€</strong> (B10
                            æˆ– B1)ã€‚</p>
                        <ul>
                            <li>Weibull åˆ†ä½ˆçš„<strong>å°¾ç«¯ï¼ˆæ—©æœŸå¤±æ•ˆå€ï¼‰</strong>å°æ•¸æ“šéå¸¸æ•æ„Ÿã€‚</li>
                            <li>å¦‚æœæ¨£æœ¬å¤ªå°‘ï¼Œä½ å¾ˆé›£ç¢ºå®šæœ€æ—©å¤±æ•ˆçš„é‚£é¡†æ˜¯ã€Œéš¨æ©Ÿçš„ç‰¹ä¾‹ã€é‚„æ˜¯ã€Œæ•´æ‰¹ç”¢å“çš„å¸¸æ…‹ã€ã€‚</li>
                            <li>æ•¸æ“šé‡å¤§æ‰èƒ½ç©©å®šæç¹ªå‡ºæ›²ç·šçš„å°¾ç«¯ã€‚</li>
                        </ul>
                    </div>

                    <div class="calculation-example" style="background-color: #fce4ec; border-color: #f48fb1;">
                        <h3>C. ç¢ºèªå¤±æ•ˆæ¨¡å¼ (\(\beta\) å€¼)</h3>
                        <p>\(\beta\) å€¼æ±ºå®šäº†ç”¢å“æ˜¯ã€Œæ—©å¤­ã€ã€ã€Œéš¨æ©Ÿå¤±æ•ˆã€é‚„æ˜¯ã€Œç£¨è€—ã€ã€‚</p>
                        <p>æ¨£æœ¬å°‘æ™‚ï¼Œéš¨ä¾¿ä¸€é¡†ç•°å¸¸å€¼ï¼ˆOutlierï¼‰éƒ½æœƒè®“ç›´ç·šæ–œç‡åŠ‡çƒˆæ³¢å‹•ï¼Œå°è‡´ä½ èª¤åˆ¤å¤±æ•ˆæ¨¡å¼ï¼ˆä¾‹å¦‚æŠŠç£¨è€—èª¤åˆ¤ç‚ºéš¨æ©Ÿå¤±æ•ˆï¼‰ï¼Œé€²è€Œé¸éŒ¯æ”¹å–„æ–¹å‘ã€‚</p>
                    </div>

                    <h3>å¦‚æœé ç®—/æ™‚é–“æœ‰é™ï¼Œæ¨£æœ¬å¾ˆå°‘æ€éº¼è¾¦ï¼Ÿ(Mouldex å¯¦å‹™å»ºè­°)</h3>
                    <p>åœ¨æ¨¡å…·æˆ–é«˜å–®åƒ¹ç”¢å“åˆ†æä¸­ï¼Œå¾€å¾€ä¸å¯èƒ½æ¸¬ 20 é¡†ã€‚é€™æ™‚æœ‰å¹¾ç¨®ç­–ç•¥ï¼š</p>

                    <div class="calculation-example" style="background-color: #e1f5fe; border-color: #4fc3f7;">
                        <h3>ç­–ç•¥ä¸€ï¼šä½¿ç”¨ã€ŒWeibayes åˆ†æã€(1åƒæ•¸ Weibull)</h3>
                        <p>å¦‚æœä½ åªæœ‰å¾ˆå°‘çš„æ¨£æœ¬ï¼ˆä¾‹å¦‚ 2-3 é¡†ï¼‰ï¼Œç”šè‡³æ²’æœ‰å¤±æ•ˆï¼ˆå…¨éƒ½æ˜¯ Suspendedï¼‰ï¼Œä½†ä½ æœ‰éå»é¡ä¼¼ç”¢å“çš„ç¶“é©—ã€‚</p>
                        <p><strong>æ–¹æ³•ï¼š</strong>å›ºå®š \(\beta\) å€¼ï¼ˆæ ¹æ“šæ­·å²ç¶“é©—ï¼Œä¾‹å¦‚é‡‘å±¬ç–²å‹é€šå¸¸ \(\beta \approx 3\)ï¼‰ï¼Œåªè¨ˆç®— \(\eta\)ã€‚</p>
                        <p><strong>å„ªé»ï¼š</strong>éœ€è¦çš„æ¨£æœ¬æ•¸æ¥µå°‘ï¼Œä¸”çµæœæ¯”æ¨™æº– Weibull æ›´å¯ä¿¡ï¼ˆå› ç‚ºåˆ©ç”¨äº†æ­·å²çŸ¥è­˜ï¼‰ã€‚</p>
                    </div>

                    <div class="calculation-example" style="background-color: #f3e5f5; border-color: #ba68c8;">
                        <h3>ç­–ç•¥äºŒï¼šå¢åŠ ã€Œè¨­é™æ•¸æ“šã€(Suspended Data)</h3>
                        <p><strong>æ–¹æ³•ï¼š</strong>ä½ å¯ä»¥åªæ¸¬åˆ° 2-3 é¡†å¤±æ•ˆï¼Œä½†åŒæ™‚æ”¾å…¥ 10 é¡†æ¨£å“ä¸€èµ·è·‘ã€‚ç•¶å‰ 3 é¡†å¤±æ•ˆå¾Œï¼Œåœæ­¢æ¸¬è©¦ã€‚</p>
                        <p><strong>åŸå› ï¼š</strong>é‚£ 7 é¡†æœªå¤±æ•ˆçš„æ•¸æ“šï¼ˆå³è¨­é™ï¼‰é›–ç„¶æ²’å£ï¼Œä½†å®ƒå€‘æä¾›äº†ã€Œé€™æ®µæ™‚é–“å…§æ²’å£ã€çš„è³‡è¨Šï¼Œé€™èƒ½é¡¯è‘—æå‡åˆ†æçš„æº–ç¢ºåº¦ï¼Œæ¯”åªæ¸¬ 3
                            é¡†å…¨éƒ¨æ¸¬åˆ°å£è¦å¥½å¾—å¤šã€‚</p>
                    </div>

                    <h3>ç¸½çµå»ºè­°</h3>
                    <p>å°æ–¼ <strong>Mouldex çš„æ‡‰ç”¨å ´æ™¯</strong>ï¼š</p>
                    <ul>
                        <li><strong>ç†æƒ³æƒ…æ³ï¼š</strong>ç›¡é‡çˆ­å– <strong class="highlight-text">10 é¡†ä»¥ä¸Š</strong>çš„æ¨£æœ¬ã€‚</li>
                        <li><strong>æœ€ä½åº•ç·šï¼š</strong>è‡³å°‘è¦æœ‰ <strong class="highlight-text">5-6 é¡†</strong>ã€‚</li>
                        <li><strong>æ¸¬è©¦ç­–ç•¥ï¼š</strong>å¦‚æœåªèƒ½æ¸¬åˆ°å°‘æ•¸å¹¾é¡†å£æ‰ï¼Œè«‹å‹™å¿…ä¿ç•™é‚£äº›ã€Œé‚„æ²’å£ã€çš„æ•¸æ“šä½œç‚º<strong>å³è¨­é™ (Suspended)</strong>
                            è¼¸å…¥åˆ°æˆ‘å€‘å‰›åšå¥½çš„ç¶²é å·¥å…·ä¸­ï¼Œé€™æ¨£èƒ½å¤§å¹…æå‡æº–ç¢ºåº¦ã€‚</li>
                    </ul>

                    <h2>6. å¦‚ä½•å–å¾—åƒæ•¸ (\(\beta, \eta\))</h2>
                    <p>åœ¨å¯¦éš›å·¥ç¨‹ä¸­ï¼Œæˆ‘å€‘ä¸æœƒæ‰‹ç®—åƒæ•¸ï¼Œé€šå¸¸ä½¿ç”¨åœ–è§£æ³•æˆ–è»Ÿé«”ï¼ˆå¦‚ä¸Šæ–¹è¨ˆç®—æ©Ÿï¼‰ï¼š</p>

                    <h3>åœ–è§£æ³• (Excel åŸç†)</h3>
                    <p>åˆ©ç”¨ Weibull ç·šæ€§åŒ–å…¬å¼è£½ä½œæ•£ä½ˆåœ–ï¼š</p>
                    <div class="formula-box">
                        $$ \ln(-\ln(1 - F(t))) = \beta \ln(t) - \beta \ln(\eta) $$
                    </div>
                    <p>åœ¨åœ–è¡¨ä¸­ï¼Œè¶¨å‹¢ç·šçš„<strong>æ–œç‡å³ç‚º \(\beta\)</strong>ã€‚</p>

                    <h3>Python ç¨‹å¼ç¯„ä¾‹</h3>
                    <p>å¦‚æœä½ ç†Ÿæ‚‰ç¨‹å¼ï¼Œä½¿ç”¨ Python çš„ <code>lifelines</code> å¥—ä»¶æ˜¯æœ€å¿«çš„æ–¹æ³•ï¼š</p>
                    <div class="code-block">
                        <pre>from lifelines import WeibullFitter

# 1. è¼¸å…¥å¤±æ•ˆæ™‚é–“æ•¸æ“š
T = [100, 150, 200, 280, 400]

# 2. æ“¬åˆæ•¸æ“š
wf = WeibullFitter()
wf.fit(T)

# 3. è¼¸å‡ºåƒæ•¸
print(f"Beta (rho_): {wf.rho_}")
print(f"Eta (lambda_): {wf.lambda_}")</pre>
                    </div>

                    <h2>7. ç‚ºä»€éº¼éœ€è¦è¼ƒå¤šæ¨£æœ¬ï¼Ÿ</h2>
                    <div
                        style="background:#e8f5e9; border:1px solid #81c784; border-radius:5px; padding:12px; margin:10px 0;">
                        <h3 style="margin:0 0 8px 0;">A. ä¿¡è³´å€é–“çš„å¯¬åº¦</h3>
                        <p>æ¨£æœ¬è¶Šå°‘ï¼Œä¸ç¢ºå®šæ€§è¶Šé«˜ã€‚5 é¡†æ¨£å“çš„ B10 ä¿¡è³´å€é–“å¯èƒ½éå¸¸å¯¬ï¼›20 é¡†å‰‡æ˜é¡¯æ”¶æ–‚ã€‚</p>
                    </div>
                    <div
                        style="background:#fff3e0; border:1px solid #ffb74d; border-radius:5px; padding:12px; margin:10px 0;">
                        <h3 style="margin:0 0 8px 0;">B. æ—©æœŸå¤±æ•ˆå°¾ç«¯çš„æ•æ„Ÿåº¦</h3>
                        <p>B1/B10 å±¬æ–¼åˆ†ä½ˆå°¾ç«¯ï¼Œå°å°‘é‡ç•°å¸¸å€¼æ¥µç‚ºæ•æ„Ÿï¼Œéœ€è¼ƒå¤šæ¨£æœ¬ç©©å®šä¼°è¨ˆã€‚</p>
                    </div>
                    <div
                        style="background:#fce4ec; border:1px solid #f48fb1; border-radius:5px; padding:12px; margin:10px 0;">
                        <h3 style="margin:0 0 8px 0;">C. ç¢ºèªå¤±æ•ˆæ¨¡å¼ (\(\beta\) å€¼)</h3>
                        <p>æ¨£æœ¬å¤ªå°‘æ™‚ï¼Œæ–œç‡å®¹æ˜“å—å–®é»å½±éŸ¿è€Œèª¤åˆ¤å¤±æ•ˆå‹æ…‹ï¼Œå°è‡´éŒ¯èª¤æ”¹å–„æ–¹å‘ã€‚</p>
                    </div>

                    <h2>8. å¯¦å‹™ç­–ç•¥</h2>
                    <div
                        style="background:#e1f5fe; border:1px solid #4fc3f7; border-radius:5px; padding:12px; margin:10px 0;">
                        <h3 style="margin:0 0 8px 0;">ç­–ç•¥ä¸€ï¼šWeibayes (1 åƒæ•¸ Weibull)</h3>
                        <p>æ¨£æœ¬æ¥µå°‘æˆ–å¤šç‚ºè¨­é™æ™‚ï¼Œä¾æ­·å²ç¶“é©—å›ºå®š \(\beta\)ï¼Œåƒ…ä¼° \(\eta\)ã€‚</p>
                    </div>
                    <div
                        style="background:#f3e5f5; border:1px solid #ba68c8; border-radius:5px; padding:12px; margin:10px 0;">
                        <h3 style="margin:0 0 8px 0;">ç­–ç•¥äºŒï¼šå¢åŠ è¨­é™æ•¸æ“š</h3>
                        <p>å°‘é‡å¤±æ•ˆæ­é…æ›´å¤šè¨­é™æ¨£æœ¬ï¼Œå¯é¡¯è‘—æå‡æ“¬åˆç©©å®šåº¦ã€‚</p>
                    </div>

                    <h2>9. å¯¦å‹™ç¸½çµ</h2>
                    <ul>
                        <li>è‡³å°‘è’é›† 10 é¡†ä»¥ä¸Šæ¨£æœ¬ï¼Œä¸¦ä¿ç•™è¨­é™æ•¸æ“š</li>
                        <li>åŒæ™‚æª¢è¦– \(\beta\)ã€\(\eta\)ã€\(R^2\) ä¸‰è€…ä»¥åˆ¤è®€å¤±æ•ˆå‹æ…‹èˆ‡å£½å‘½</li>
                        <li>ä»¥ Bâ€‘Life æŒ‡æ¨™æºé€šå·¥ç¨‹èˆ‡å•†å‹™ï¼ˆä¿å›ºã€å£½å‘½ã€æ”¹å–„å¹…åº¦ï¼‰</li>
                    </ul>

                    <h2>10. å·®ç•°åˆ†æçš„ç†è«–è£œå……ï¼ˆé›™çµ„æ¯”è¼ƒï¼‰</h2>
                    <h3>\(\beta\) å·®ç•°çš„æ„ç¾©</h3>
                    <ul>
                        <li>\(\beta_B > \beta_A\)ï¼šB çµ„å¤±æ•ˆç‡éš¨æ™‚é–“ä¸Šå‡æ›´å¿«ï¼Œå±¬ç£¨è€—åŠ åŠ‡ï¼Œå°¾ç«¯å¤±æ•ˆæ›´é›†ä¸­</li>
                        <li>\(\beta_B \approx \beta_A\)ï¼šå…©çµ„å¤±æ•ˆå‹æ…‹ç›¸è¿‘ï¼Œé©åˆç”¨ \(\eta\) æˆ– Bâ€‘Life ç›´æ¥æ¯”è¼ƒå£½å‘½</li>
                        <li>\(\beta_B < \beta_A\)ï¼šB çµ„è¼ƒå‚¾å‘æ—©æœŸå¤±æ•ˆï¼Œéœ€æª¢è¨è£½ç¨‹ï¼å“è³ªä¸€è‡´æ€§</li>
                    </ul>

                    <h3>\(\eta\) æ”¹å–„ç‡çš„åˆ¤è®€</h3>
                    <div
                        style="text-align:center; padding:10px; background:#f8f9fa; border:1px solid #dee2e6; border-radius:5px; margin:10px 0;">
                        $$ \text{\% æ”¹å–„} = \left(\frac{\eta_B}{\eta_A} - 1\right) \times 100\% $$
                    </div>
                    <ul>
                        <li>é©ç”¨æƒ…å¢ƒï¼š\(|\beta_B - \beta_A| \le 0.2\)ï¼ˆå¤±æ•ˆå‹æ…‹è¿‘ä¼¼ï¼‰</li>
                        <li>è§£è®€ï¼š\(\eta_B/\eta_A = 1.30\) è¡¨ç¤ºå£½å‘½å»¶é•·ç´„ 30%</li>
                    </ul>

                    <h3>ç•¶ \(\beta\) ä¸åŒæ™‚çš„æ¯”è¼ƒæ–¹å¼</h3>
                    <ul>
                        <li>å›ºå®šå¯é åº¦æ¯”è¼ƒï¼šé¸å®š \(R\)ï¼ˆå¦‚ 95%ã€90%ï¼‰ï¼Œæ¯”è¼ƒå…©çµ„çš„ \(t(R)\)</li>
                    </ul>
                    <div
                        style="text-align:center; padding:10px; background:#fff3cd; border:1px solid #ffc107; border-radius:5px; margin:10px 0;">
                        $$ t(R) = \eta \times \big(-\ln(R)\big)^{1/\beta} $$
                    </div>
                    <ul>
                        <li>Bâ€‘Life æ¯”è¼ƒï¼šä»¥ \(B10\)ã€\(B50\) æˆ– \(B1\) ç‚ºæŒ‡æ¨™ï¼Œæ¯”è¼ƒ \(t_{B,\,x} / t_{A,\,x}\)</li>
                        <li>å„ªé»ï¼šé¿å…åƒ…ä»¥ \(\eta\) åˆ¤æ–·è€Œå¿½ç•¥ \(\beta\) å°å°¾ç«¯çš„å½±éŸ¿</li>
                    </ul>

                    <h3>åˆ¤è®€ç¯„ä¾‹ï¼ˆæ–‡å­—åŒ–ï¼‰</h3>
                    <div
                        style="background:#e8f6f3; border:1px solid #a2d9ce; border-radius:5px; padding:12px; margin:10px 0;">
                        <p>ä¾‹ä¸€ï¼ˆå‹æ…‹ç›¸è¿‘ï¼‰ï¼š\(\beta_A = 1.2,\ \eta_A = 500;\ \beta_B = 1.2,\ \eta_B = 650\)ã€‚å‰‡ \(\eta\) æ”¹å–„ â‰ˆ
                            30%ï¼ŒB10 æ¯”è¼ƒäº¦ç´„ 30% æå‡ã€‚</p>
                        <p>ä¾‹äºŒï¼ˆå‹æ…‹ä¸åŒï¼‰ï¼š\(\beta_A = 1.0,\ \eta_A = 520;\ \beta_B = 1.6,\ \eta_B = 650\)ã€‚ä»¥ \(R=90\%\)
                            æ¯”è¼ƒï¼šè¨ˆç®— \(t_A(0.9)\) èˆ‡ \(t_B(0.9)\)ï¼›è‹¥ \(t_B/t_A > 1\)ï¼Œè¡¨ç¤ºåœ¨è©²å¯é åº¦ä¸‹ B çµ„æ›´è€ä¹…ã€‚</p>
                    </div>

                    <h3>åˆ¤è®€å„ªå…ˆé †åº</h3>
                    <table style="width:100%; border-collapse:collapse; margin:12px 0;">
                        <thead>
                            <tr style="background:#34495e; color:#fff;">
                                <th style="padding:8px; border:1px solid #ddd;">æ­¥é©Ÿ</th>
                                <th style="padding:8px; border:1px solid #ddd;">é‡é»</th>
                                <th style="padding:8px; border:1px solid #ddd;">èªªæ˜</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding:8px; border:1px solid #ddd; text-align:center;">1</td>
                                <td style="padding:8px; border:1px solid #ddd;">æª¢æŸ¥ \(R^2\)</td>
                                <td style="padding:8px; border:1px solid #ddd;">æ“¬åˆåº¦ä¸è¶³æ™‚é¿å…æ·±å…¥æ¯”è¼ƒ</td>
                            </tr>
                            <tr style="background:#f9f9f9;">
                                <td style="padding:8px; border:1px solid #ddd; text-align:center;">2</td>
                                <td style="padding:8px; border:1px solid #ddd;">æ¯”è¼ƒ \(\beta\)</td>
                                <td style="padding:8px; border:1px solid #ddd;">å‹æ…‹ç›¸è¿‘è€…å¯ç›´æ¥ç”¨ \(\eta\)/Bâ€‘Lifeï¼›å‹æ…‹ä¸åŒç”¨
                                    \(t(R)\)</td>
                            </tr>
                            <tr>
                                <td style="padding:8px; border:1px solid #ddd; text-align:center;">3</td>
                                <td style="padding:8px; border:1px solid #ddd;">é¸æ“‡æ¯”è¼ƒæŒ‡æ¨™</td>
                                <td style="padding:8px; border:1px solid #ddd;">ç›¸è¿‘ï¼š\(\eta\) æ”¹å–„ç‡ï¼›ä¸åŒï¼šå›ºå®š \(R\) æˆ– Bâ€‘Life
                                </td>
                            </tr>
                            <tr style="background:#f9f9f9;">
                                <td style="padding:8px; border:1px solid #ddd; text-align:center;">4</td>
                                <td style="padding:8px; border:1px solid #ddd;">å½¢æˆçµè«–</td>
                                <td style="padding:8px; border:1px solid #ddd;">ç”¨æ˜ç¢ºç™¾åˆ†æ¯”æˆ–æ™‚é–“æ¯”å€¼å‘ˆç¾å·®ç•°</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="batch-buttons" style="grid-template-columns: 1fr;">
                    <button class="btn-clear" onclick="closeTheory()">é—œé–‰</button>
                </div>
            </div>
        </div>

        <script>
            let dataGroupA = [];
            let dataGroupB = [];
            let analysisResults = null;
            let markerReliabilityPercent = 95;
            let chartProb = null;
            let chartRel = null;

            window.onload = function () {
                const tInputA = document.getElementById("tInputA");
                const sInputA = document.getElementById("sInputA");
                const markerRInput = document.getElementById('markerRInput');

                // Initialize Mode
                setAnalysisMode('dual'); // Default to dual

                // Force button text to be correct (safeguard)
                const btn = document.getElementById('btnRunAnalysis');
                if (btn) btn.innerHTML = 'ğŸ” é–‹å§‹åˆ†æ';

                tInputA.addEventListener("keydown", function (event) {
                    if (event.key === "Enter") { event.preventDefault(); addData('A'); }
                });
                sInputA.addEventListener("keydown", function (event) {
                    if (event.key === "Enter") { event.preventDefault(); addData('A'); }
                });

                const tInputB = document.getElementById("tInputB");
                const sInputB = document.getElementById("sInputB");
                tInputB.addEventListener("keydown", function (event) {
                    if (event.key === "Enter") { event.preventDefault(); addData('B'); }
                });
                sInputB.addEventListener("keydown", function (event) {
                    if (event.key === "Enter") { event.preventDefault(); addData('B'); }
                });

                function updateMarkerR() {
                    let val = parseFloat(markerRInput.value);
                    if (isNaN(val)) val = 95;
                    if (val < 0) val = 0;
                    if (val > 99.9) val = 99.9;
                    markerReliabilityPercent = val;
                    if (analysisResults) {
                        drawCharts(analysisResults.groupA, analysisResults.groupB);
                    }
                }
                markerRInput.addEventListener('change', updateMarkerR);
                markerRInput.addEventListener('keydown', function (e) { if (e.key === 'Enter') { e.preventDefault(); updateMarkerR(); } });

                tInputA.focus();
            };

            let currentBatchGroup = 'A'; // è¨˜éŒ„ç•¶å‰æ‰¹æ¬¡è¼¸å…¥çš„çµ„åˆ¥

            function setAnalysisMode(mode) {
                const container = document.querySelector('.container');
                const runBtn = document.querySelector('.btn-calc'); // Get Run button

                if (mode === 'single') {
                    container.classList.add('mode-single');
                    container.classList.remove('mode-dual');
                    runBtn.innerHTML = 'ğŸ” é–‹å§‹åˆ†æ';
                } else {
                    container.classList.remove('mode-single');
                    container.classList.add('mode-dual');
                    runBtn.innerHTML = 'ğŸ” é–‹å§‹æ¯”å°';
                }

                // Trigger analysis re-run if we have data, to refresh results visibility
                if (dataGroupA.length > 0) {
                    // Optional: automatically re-run or clear B results visually
                    // For now, let's just ensure the UI state is correct
                    if (mode === 'single') {
                        document.querySelector('.group-result.group-b').style.display = 'none';
                        document.querySelector('.diff-panel').style.display = 'none';
                    }
                }
            }

            function addData(group) {
                const tInput = document.getElementById('tInput' + group);
                const t = parseFloat(tInput.value);
                const s = document.getElementById('sInput' + group).value;
                if (isNaN(t) || t <= 0) {
                    if (tInput.value !== "") alert("è«‹è¼¸å…¥å¤§æ–¼ 0 çš„æœ‰æ•ˆæ™‚é–“");
                    return;
                }

                if (group === 'A') {
                    dataGroupA.push({ t: t, s: s });
                    sortDataArray(dataGroupA);
                    updateTable('A');
                } else {
                    dataGroupB.push({ t: t, s: s });
                    sortDataArray(dataGroupB);
                    updateTable('B');
                }

                tInput.value = '';
                tInput.focus();
            }

            function showBatchInput(group) {
                currentBatchGroup = group;
                const groupName = document.getElementById('groupName' + group).value;
                document.getElementById('batchModalTitle').textContent = `ğŸ“‹ æ‰¹æ¬¡è¼¸å…¥æ•¸æ“š - ${groupName}`;
                document.getElementById('batchModal').style.display = 'block';
                document.getElementById('batchTextarea').value = '';
                document.getElementById('batchTextarea').focus();
            }

            function closeBatchInput() {
                document.getElementById('batchModal').style.display = 'none';
            }

            function openTheory() {
                document.getElementById('theoryModal').style.display = 'block';
            }

            function closeTheory() {
                document.getElementById('theoryModal').style.display = 'none';
            }

            function processBatchInput() {
                const textarea = document.getElementById('batchTextarea');
                const text = textarea.value.trim();

                if (!text) {
                    alert("è«‹è¼¸å…¥æ•¸æ“šï¼");
                    return;
                }

                const lines = text.split('\n');
                let successCount = 0;
                let errorCount = 0;
                const errors = [];

                lines.forEach((line, index) => {
                    line = line.trim();
                    if (!line) return;

                    const parts = line.split(/[\t,\s]+/);

                    if (parts.length < 2) {
                        errors.push(`ç¬¬ ${index + 1} è¡Œï¼šæ ¼å¼éŒ¯èª¤ï¼ˆéœ€è¦å…©æ¬„æ•¸æ“šï¼‰`);
                        errorCount++;
                        return;
                    }

                    const t = parseFloat(parts[0]);
                    let s = parts[1].toUpperCase();

                    if (isNaN(t) || t <= 0) {
                        errors.push(`ç¬¬ ${index + 1} è¡Œï¼šå£½å‘½å¿…é ˆæ˜¯å¤§æ–¼ 0 çš„æ•¸å­—`);
                        errorCount++;
                        return;
                    }

                    if (s !== 'F' && s !== 'S') {
                        errors.push(`ç¬¬ ${index + 1} è¡Œï¼šç‹€æ…‹å¿…é ˆæ˜¯ F æˆ– S`);
                        errorCount++;
                        return;
                    }

                    if (currentBatchGroup === 'A') {
                        dataGroupA.push({ t: t, s: s });
                    } else {
                        dataGroupB.push({ t: t, s: s });
                    }
                    successCount++;
                });

                if (successCount > 0) {
                    if (currentBatchGroup === 'A') {
                        sortDataArray(dataGroupA);
                        updateTable('A');
                    } else {
                        sortDataArray(dataGroupB);
                        updateTable('B');
                    }
                }

                closeBatchInput();

                if (errorCount > 0) {
                    alert(`âœ… æˆåŠŸåŠ å…¥ ${successCount} ç­†æ•¸æ“š\nâŒ ${errorCount} ç­†æ•¸æ“šæœ‰èª¤ï¼š\n\n${errors.slice(0, 5).join('\n')}${errors.length > 5 ? '\n...(æ›´å¤šéŒ¯èª¤)' : ''}`);
                } else {
                    alert(`âœ… æˆåŠŸåŠ å…¥ ${successCount} ç­†æ•¸æ“šï¼`);
                }
            }

            window.onclick = function (event) {
                const modal = document.getElementById('batchModal');
                const theory = document.getElementById('theoryModal');
                if (event.target === modal) { closeBatchInput(); }
                if (event.target === theory) { closeTheory(); }
            }

            function loadDemo(group) {
                if (group === 'A') {
                    dataGroupA = [
                        { t: 300, s: 'F' }, { t: 100, s: 'F' }, { t: 250, s: 'S' },
                        { t: 150, s: 'F' }, { t: 550, s: 'F' }, { t: 120, s: 'S' },
                        { t: 400, s: 'F' }, { t: 200, s: 'F' }
                    ];
                    sortDataArray(dataGroupA);
                    updateTable('A');
                } else {
                    dataGroupB = [
                        { t: 450, s: 'F' }, { t: 200, s: 'F' }, { t: 350, s: 'S' },
                        { t: 250, s: 'F' }, { t: 700, s: 'F' }, { t: 180, s: 'S' },
                        { t: 500, s: 'F' }, { t: 300, s: 'F' }
                    ];
                    sortDataArray(dataGroupB);
                    updateTable('B');
                }
            }

            function sortDataArray(data) {
                data.sort((a, b) => {
                    if (a.t !== b.t) return a.t - b.t;
                    return (a.s === 'F' ? -1 : 1);
                });
            }

            function clearData(group) {
                if (group === 'A') {
                    dataGroupA = [];
                    updateTable('A');
                } else {
                    dataGroupB = [];
                    updateTable('B');
                }
            }

            function clearAllData() {
                if (!confirm('ç¢ºå®šè¦æ¸…ç©ºå…©çµ„çš„æ‰€æœ‰æ•¸æ“šå’Œåœ–è¡¨å—ï¼Ÿ')) {
                    return;
                }

                // æ¸…ç©ºå…©çµ„æ•¸æ“š
                dataGroupA = [];
                dataGroupB = [];
                analysisResults = null;

                // æ›´æ–°è¡¨æ ¼
                updateTable('A');
                updateTable('B');

                // æ¸…é™¤åœ–è¡¨
                Plotly.purge('chartProb');
                Plotly.purge('chartRel');

                // éš±è—çµæœé¢æ¿
                document.getElementById('groupResultA').style.display = 'none';
                document.getElementById('groupResultB').style.display = 'none';
                document.getElementById('diffPanel').style.display = 'none';

                alert('âœ… å·²æ¸…ç©ºæ‰€æœ‰æ•¸æ“šå’Œåœ–è¡¨ï¼');
            }

            function deleteRow(group, idx) {
                if (group === 'A') {
                    dataGroupA.splice(idx, 1);
                    updateTable('A');
                } else {
                    dataGroupB.splice(idx, 1);
                    updateTable('B');
                }
            }

            function updateTable(group) {
                const data = (group === 'A') ? dataGroupA : dataGroupB;
                const tbody = document.querySelector('#dataTable' + group + ' tbody');
                tbody.innerHTML = '';
                data.forEach((item, idx) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td style="color:#aaa;">${idx + 1}</td>
                <td style="font-weight:bold;">${item.t}</td>
                <td style="color:${item.s === 'F' ? '#e74c3c' : '#2980b9'}; font-weight:bold;">
                    ${item.s === 'F' ? 'å¤±æ•ˆ (F)' : 'è¨­é™ (S)'}
                </td>
                <td><button class="btn-del" onclick="deleteRow('${group}', ${idx})">X</button></td>
            `;
                    tbody.appendChild(tr);
                });
                const container = tbody.closest('.table-container');
                container.scrollTop = container.scrollHeight;
            }

            function runAnalysis() {
                const failuresA = dataGroupA.filter(d => d.s === 'F').length;
                const failuresB = dataGroupB.filter(d => d.s === 'F').length;
                const mode = document.querySelector('input[name="analysisMode"]:checked').value;

                // Mode-aware validation
                if (mode === 'single') {
                    if (failuresA < 2) {
                        alert("éŒ¯èª¤ï¼šå–®çµ„æ¨¡å¼ä¸‹ï¼Œçµ„åˆ¥ A è‡³å°‘éœ€è¦ 2 ç­†å¤±æ•ˆæ•¸æ“š (Failure) æ‰èƒ½é€²è¡Œåˆ†æã€‚");
                        return;
                    }
                } else {
                    // Dual mode validation
                    if (failuresA < 2 && failuresB < 2) {
                        alert("éŒ¯èª¤ï¼šè‡³å°‘éœ€è¦ä¸€çµ„æœ‰ 2 å€‹ä»¥ä¸Šçš„å¤±æ•ˆæ•¸æ“š (Failure) æ‰èƒ½è¨ˆç®—åƒæ•¸ã€‚");
                        return;
                    }
                }

                // Start Analysis

                let resultsA = null;
                if (failuresA >= 2) {
                    resultsA = performWeibullAnalysis(dataGroupA);
                    displayGroupResults('A', resultsA);
                }

                let resultsB = null;
                if (mode === 'dual' && failuresB >= 2) {
                    resultsB = performWeibullAnalysis(dataGroupB);
                    displayGroupResults('B', resultsB);
                } else {
                    document.querySelector('.group-result.group-b').style.display = 'none';
                }

                adjustUILayout(resultsA, resultsB);

                if (resultsA && resultsB && mode === 'dual') {
                    displayDifferenceAnalysis(resultsA, resultsB);
                    document.querySelector('.diff-panel').style.display = 'block';
                } else {
                    document.querySelector('.diff-panel').style.display = 'none';
                }

                analysisResults = {
                    groupA: resultsA,
                    groupB: resultsB,
                    mode: (resultsA && resultsB && mode === 'dual') ? 'dual' : 'single'
                };

                document.getElementById('resultPanel').style.display = 'block';
                drawCharts(resultsA, resultsB);
            }

            function adjustUILayout(resultsA, resultsB) {
                const comparisonGrid = document.querySelector('.comparison-grid');
                const groupResultA = comparisonGrid.querySelector('.group-result.group-a');
                const groupResultB = comparisonGrid.querySelector('.group-result.group-b');
                const resultTitle = document.getElementById('resultTitle');

                if (resultsA && resultsB) {
                    comparisonGrid.style.gridTemplateColumns = '1fr 1fr';
                    groupResultA.style.display = 'block';
                    groupResultB.style.display = 'block';
                    resultTitle.innerText = 'é›™çµ„æ¯”å°çµæœ';
                    document.getElementById('groupANameBadge').innerText = document.getElementById('groupNameA').value;
                    document.getElementById('groupBNameBadge').innerText = document.getElementById('groupNameB').value;
                } else if (resultsA) {
                    comparisonGrid.style.gridTemplateColumns = '1fr';
                    groupResultA.style.display = 'block';
                    groupResultB.style.display = 'none';
                    resultTitle.innerText = 'å–®çµ„åˆ†æçµæœ';
                    document.getElementById('groupANameBadge').innerText = document.getElementById('groupNameA').value;
                } else if (resultsB) {
                    comparisonGrid.style.gridTemplateColumns = '1fr';
                    groupResultA.style.display = 'none';
                    groupResultB.style.display = 'block';
                    resultTitle.innerText = 'åˆ†æçµæœ - ' + document.getElementById('groupNameB').value;
                }
            }

            function performWeibullAnalysis(data) {
                sortDataArray(data);
                const N = data.length;
                let points = [];
                let previousOrderNumber = 0;

                for (let i = 0; i < N; i++) {
                    let item = data[i];
                    let reverseRank = N - i;
                    let increment = ((N + 1) - previousOrderNumber) / reverseRank;
                    let newOrderNumber = previousOrderNumber + increment;
                    if (item.s === 'F') {
                        let medianRank = (newOrderNumber - 0.3) / (N + 0.4);
                        if (medianRank >= 0.99999) medianRank = 0.99999;
                        let x = Math.log(item.t);
                        let term = -Math.log(1 - medianRank);
                        let y = Math.log(term);
                        if (isFinite(x) && isFinite(y)) {
                            points.push({ x: x, y: y, t: item.t });
                        }
                    }
                    previousOrderNumber = newOrderNumber;
                }

                if (points.length < 2) {
                    return null;
                }

                let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
                let nP = points.length;
                points.forEach(p => {
                    sumX += p.x; sumY += p.y;
                    sumXY += (p.x * p.y); sumXX += (p.x * p.x);
                });
                let slope = (nP * sumXY - sumX * sumY) / (nP * sumXX - sumX * sumX);
                let intercept = (sumY - slope * sumX) / nP;
                let beta = slope;
                let eta = Math.exp(-intercept / beta);
                let yMean = sumY / nP;
                let ssTot = points.reduce((acc, p) => acc + Math.pow(p.y - yMean, 2), 0);
                let ssRes = points.reduce((acc, p) => acc + Math.pow(p.y - (slope * p.x + intercept), 2), 0);
                let r2 = 1 - (ssRes / ssTot);

                let typeText = "";
                if (beta < 1) typeText = "æ—©æœŸå¤±æ•ˆ (Infant Mortality)";
                else if (beta < 1.1) typeText = "éš¨æ©Ÿå¤±æ•ˆ (Constant Failure Rate)";
                else typeText = "ç£¨è€—å¤±æ•ˆ (Wear-out)";

                return {
                    beta: beta,
                    eta: eta,
                    r2: r2,
                    failureMode: typeText,
                    points: points,
                    slope: slope,
                    intercept: intercept,
                    maxT: data[N - 1].t
                };
            }

            function displayGroupResults(group, results) {
                if (!results) return;

                // Note: Group Name is now handled in adjustUILayout via groupANameBadge/groupBNameBadge
                document.getElementById('valBeta' + group).innerText = results.beta.toFixed(4);
                document.getElementById('valEta' + group).innerText = results.eta.toFixed(2);
                document.getElementById('valR2' + group).innerText = results.r2.toFixed(4);
                document.getElementById('descText' + group).innerText = `å¤±æ•ˆæ¨¡å¼: ${results.failureMode}`;
            }

            function displayDifferenceAnalysis(resultsA, resultsB) {
                const betaDiffPct = ((resultsB.beta - resultsA.beta) / resultsA.beta * 100);
                const etaDiffPct = ((resultsB.eta - resultsA.eta) / resultsA.eta * 100);

                document.getElementById('diffBeta').innerText = (betaDiffPct >= 0 ? '+' : '') + betaDiffPct.toFixed(2) + '%';
                document.getElementById('diffEta').innerText = (etaDiffPct >= 0 ? '+' : '') + etaDiffPct.toFixed(2) + '%';
                document.getElementById('diffImprovement').innerText = (etaDiffPct >= 0 ? '+' : '') + etaDiffPct.toFixed(2) + '%';

                const betaA = resultsA.beta;
                const betaB = resultsB.beta;
                const etaA = resultsA.eta;
                const etaB = resultsB.eta;
                const r2A = resultsA.r2;
                const r2B = resultsB.r2;
                const absBetaDelta = Math.abs(betaB - betaA);

                const parts = [];
                if (r2A < 0.80 || r2B < 0.80) {
                    parts.push('âš ï¸ æ“¬åˆåº¦åä½ (RÂ²<0.80)ï¼Œçµæœåƒ…ä¾›åƒè€ƒ');
                }

                if (absBetaDelta <= 0.2) {
                    parts.push('å‹æ…‹ç›¸è¿‘ï¼šÎ² å·®ç•°å° (|Î”Î²|â‰¤0.2)ï¼Œä»¥ Î· æ”¹å–„ç‡åˆ¤è®€');
                    parts.push(`Î· æ”¹å–„ â‰ˆ ${(etaDiffPct).toFixed(2)}%`);
                    const R90 = 0.90;
                    const tA90 = etaA * Math.pow(-Math.log(R90), 1 / betaA);
                    const tB90 = etaB * Math.pow(-Math.log(R90), 1 / betaB);
                    const tImprovement90 = ((tB90 - tA90) / tA90) * 100;
                    parts.push(`R=90% æ™‚ï¼šA=${tA90.toFixed(2)}ï¼ŒB=${tB90.toFixed(2)}ï¼Œå·®ç•° â‰ˆ ${(tImprovement90 >= 0 ? '+' : '') + tImprovement90.toFixed(2)}%`);
                    const R95 = 0.95;
                    const tA95 = etaA * Math.pow(-Math.log(R95), 1 / betaA);
                    const tB95 = etaB * Math.pow(-Math.log(R95), 1 / betaB);
                    const tImprovement95 = ((tB95 - tA95) / tA95) * 100;
                    parts.push(`R=95% æ™‚ï¼šA=${tA95.toFixed(2)}ï¼ŒB=${tB95.toFixed(2)}ï¼Œå·®ç•° â‰ˆ ${(tImprovement95 >= 0 ? '+' : '') + tImprovement95.toFixed(2)}%`);
                    const Rb10 = 0.90; // B10 å³ R=90%
                    const tAB10 = tA90;
                    const tBB10 = tB90;
                    const b10Improvement = tImprovement90;
                    parts.push(`B10 å£½å‘½ï¼šA=${tAB10.toFixed(2)}ï¼ŒB=${tBB10.toFixed(2)} (${(b10Improvement >= 0 ? '+' : '') + b10Improvement.toFixed(2)}%)`);
                } else {
                    parts.push('å‹æ…‹ä¸åŒï¼šÎ² å·®ç•°æ˜é¡¯ï¼Œå»ºè­°ä»¥å›ºå®šå¯é åº¦æˆ– Bâ€‘Life æ¯”è¼ƒ');
                    const R90 = 0.90;
                    const tA90 = etaA * Math.pow(-Math.log(R90), 1 / betaA);
                    const tB90 = etaB * Math.pow(-Math.log(R90), 1 / betaB);
                    const tImprovement90 = ((tB90 - tA90) / tA90) * 100;
                    parts.push(`R=90% æ™‚ï¼šA=${tA90.toFixed(2)}ï¼ŒB=${tB90.toFixed(2)}ï¼Œå·®ç•° â‰ˆ ${(tImprovement90 >= 0 ? '+' : '') + tImprovement90.toFixed(2)}%`);
                    const R95 = 0.95;
                    const tA95 = etaA * Math.pow(-Math.log(R95), 1 / betaA);
                    const tB95 = etaB * Math.pow(-Math.log(R95), 1 / betaB);
                    const tImprovement95 = ((tB95 - tA95) / tA95) * 100;
                    parts.push(`R=95% æ™‚ï¼šA=${tA95.toFixed(2)}ï¼ŒB=${tB95.toFixed(2)}ï¼Œå·®ç•° â‰ˆ ${(tImprovement95 >= 0 ? '+' : '') + tImprovement95.toFixed(2)}%`);
                    const R50 = 0.50;
                    const tA50 = etaA * Math.pow(-Math.log(R50), 1 / betaA);
                    const tB50 = etaB * Math.pow(-Math.log(R50), 1 / betaB);
                    const tImprovement50 = ((tB50 - tA50) / tA50) * 100;
                    parts.push(`B50 ä¸­ä½å£½å‘½ï¼šA=${tA50.toFixed(2)}ï¼ŒB=${tB50.toFixed(2)} (${(tImprovement50 >= 0 ? '+' : '') + tImprovement50.toFixed(2)}%)`);
                    const b10Improvement = tImprovement90;
                    parts.push(`B10 å£½å‘½ï¼šA=${tA90.toFixed(2)}ï¼ŒB=${tB90.toFixed(2)} (${(b10Improvement >= 0 ? '+' : '') + b10Improvement.toFixed(2)}%)`);
                }

                if (betaB > betaA) {
                    parts.push('Î²_B > Î²_Aï¼šB çµ„ç£¨è€—è¶¨å‹¢è¼ƒå¼·');
                } else if (betaB < betaA) {
                    parts.push('Î²_B < Î²_Aï¼šB çµ„è¼ƒå‚¾å‘æ—©æœŸå¤±æ•ˆ');
                }

                document.getElementById('diffInterpretation').innerText = parts.join('ï¼›');
            }

            function exportData() {
                if (!analysisResults || (!analysisResults.groupA && !analysisResults.groupB)) {
                    alert("è«‹å…ˆåŸ·è¡Œåˆ†æä»¥ç”¢ç”Ÿçµæœ!");
                    return;
                }

                const groupNameA = document.getElementById('groupNameA').value;
                const groupNameB = document.getElementById('groupNameB').value;
                const mode = analysisResults.mode;

                let csvContent = `Weibull å¯é åº¦åˆ†æçµæœ - ${mode === 'dual' ? 'é›™çµ„æ¯”å°' : 'å–®çµ„åˆ†æ'}\n\n`;

                if (analysisResults.groupA) {
                    csvContent += `=== ${groupNameA} åˆ†æåƒæ•¸ ===\n`;
                    csvContent += "åƒæ•¸åç¨±,æ•¸å€¼\n";
                    csvContent += `å½¢ç‹€åƒæ•¸ Beta (Î²),${analysisResults.groupA.beta.toFixed(4)}\n`;
                    csvContent += `ç‰¹å¾µå£½å‘½ Eta (Î·),${analysisResults.groupA.eta.toFixed(2)}\n`;
                    csvContent += `æ“¬åˆåº¦ RÂ²,${analysisResults.groupA.r2.toFixed(4)}\n`;
                    csvContent += `å¤±æ•ˆæ¨¡å¼,${analysisResults.groupA.failureMode}\n\n`;
                }

                if (analysisResults.groupB) {
                    csvContent += `=== ${groupNameB} åˆ†æåƒæ•¸ ===\n`;
                    csvContent += "åƒæ•¸åç¨±,æ•¸å€¼\n";
                    csvContent += `å½¢ç‹€åƒæ•¸ Beta (Î²),${analysisResults.groupB.beta.toFixed(4)}\n`;
                    csvContent += `ç‰¹å¾µå£½å‘½ Eta (Î·),${analysisResults.groupB.eta.toFixed(2)}\n`;
                    csvContent += `æ“¬åˆåº¦ RÂ²,${analysisResults.groupB.r2.toFixed(4)}\n`;
                    csvContent += `å¤±æ•ˆæ¨¡å¼,${analysisResults.groupB.failureMode}\n\n`;
                }

                if (analysisResults.groupA && analysisResults.groupB) {
                    const betaDiff = ((analysisResults.groupB.beta - analysisResults.groupA.beta) / analysisResults.groupA.beta * 100);
                    const etaDiff = ((analysisResults.groupB.eta - analysisResults.groupA.eta) / analysisResults.groupA.eta * 100);
                    csvContent += "=== å·®ç•°åˆ†æ (B vs A) ===\n";
                    csvContent += "é …ç›®,å·®ç•°ç™¾åˆ†æ¯”\n";
                    csvContent += `Beta å·®ç•°,${betaDiff.toFixed(2)}%\n`;
                    csvContent += `Eta å·®ç•°,${etaDiff.toFixed(2)}%\n`;
                    csvContent += `å£½å‘½æ”¹å–„ç‡,${etaDiff.toFixed(2)}%\n\n`;
                }

                if (dataGroupA.length > 0) {
                    csvContent += `=== ${groupNameA} åŸå§‹æ•¸æ“š ===\n`;
                    csvContent += "åºè™Ÿ,å£½å‘½ (t),ç‹€æ…‹(F:å¤±æ•ˆ/S:å³è¨­é™) \n";
                    dataGroupA.forEach((item, idx) => {
                        csvContent += `${idx + 1},${item.t},${item.s}\n`;
                    });
                    csvContent += "\n";
                }

                if (dataGroupB.length > 0) {
                    csvContent += `=== ${groupNameB} åŸå§‹æ•¸æ“š ===\n`;
                    csvContent += "åºè™Ÿ,å£½å‘½ (t),ç‹€æ…‹(F:å¤±æ•ˆ/S:å³è¨­é™) \n";
                    dataGroupB.forEach((item, idx) => {
                        csvContent += `${idx + 1},${item.t},${item.s}\n`;
                    });
                    csvContent += "\n";
                }

                // æ·»åŠ è©³ç´°çš„å¯é åº¦æ›²ç·šæ•¸æ“š
                if (analysisResults.groupA) {
                    const maxT = Math.max(...dataGroupA.map(d => d.t)) * 1.5;
                    csvContent += `=== ${groupNameA} å¯é åº¦æ›²ç·šæ•¸æ“š (200é») ===\n`;
                    csvContent += "å£½å‘½ (t),å¯é åº¦ R(t) (%),å¤±æ•ˆç‡ F(t) (%)\n";
                    for (let i = 0; i <= 200; i++) {
                        const t = maxT * i / 200;
                        const R = Math.exp(-Math.pow(t / analysisResults.groupA.eta, analysisResults.groupA.beta)) * 100;
                        const F = 100 - R;
                        csvContent += `${t.toFixed(2)},${R.toFixed(4)},${F.toFixed(4)}\n`;
                    }
                    csvContent += "\n";

                    // B-Life æ•¸æ“š
                    csvContent += `=== ${groupNameA} B-Life æ•¸æ“š ===\n`;
                    csvContent += "B-Life,æ™‚é–“ (t),èªªæ˜\n";
                    const bLifeValues = [1, 5, 10, 20, 50];
                    bLifeValues.forEach(b => {
                        const R = (100 - b) / 100;
                        const t = analysisResults.groupA.eta * Math.pow(-Math.log(R), 1 / analysisResults.groupA.beta);
                        csvContent += `B${b},${t.toFixed(2)},${b}% ç”¢å“å¤±æ•ˆæ™‚çš„å£½å‘½\n`;
                    });
                    csvContent += "\n";
                }

                if (analysisResults.groupB) {
                    const maxT = Math.max(...dataGroupB.map(d => d.t)) * 1.5;
                    csvContent += `=== ${groupNameB} å¯é åº¦æ›²ç·šæ•¸æ“š (200é») ===\n`;
                    csvContent += "å£½å‘½ (t),å¯é åº¦ R(t) (%),å¤±æ•ˆç‡ F(t) (%)\n";
                    for (let i = 0; i <= 200; i++) {
                        const t = maxT * i / 200;
                        const R = Math.exp(-Math.pow(t / analysisResults.groupB.eta, analysisResults.groupB.beta)) * 100;
                        const F = 100 - R;
                        csvContent += `${t.toFixed(2)},${R.toFixed(4)},${F.toFixed(4)}\n`;
                    }
                    csvContent += "\n";

                    // B-Life æ•¸æ“š
                    csvContent += `=== ${groupNameB} B-Life æ•¸æ“š ===\n`;
                    csvContent += "B-Life,æ™‚é–“ (t),èªªæ˜\n";
                    const bLifeValues = [1, 5, 10, 20, 50];
                    bLifeValues.forEach(b => {
                        const R = (100 - b) / 100;
                        const t = analysisResults.groupB.eta * Math.pow(-Math.log(R), 1 / analysisResults.groupB.beta);
                        csvContent += `B${b},${t.toFixed(2)},${b}% ç”¢å“å¤±æ•ˆæ™‚çš„å£½å‘½\n`;
                    });
                    csvContent += "\n";
                }

                const blob = new Blob(["\ufeff" + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", `Weibull_åˆ†æ_${mode === 'dual' ? 'é›™çµ„æ¯”å°' : 'å–®çµ„'}_${new Date().toISOString().slice(0, 10)}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                alert("âœ… å®Œæ•´æ•¸æ“šå·²æˆåŠŸåŒ¯å‡ºç‚º CSV æª”æ¡ˆ!");
            }



            function applyStyleScale(chartData, chartOptions, scale, preferThin) {
                if (!chartOptions.plugins) chartOptions.plugins = {};
                if (!chartOptions.plugins.legend) chartOptions.plugins.legend = {};
                if (!chartOptions.plugins.legend.labels) chartOptions.plugins.legend.labels = {};
                const legendFontSize = ((chartOptions.plugins.legend.labels.font && chartOptions.plugins.legend.labels.font.size) || 12);
                chartOptions.plugins.legend.labels.font = { size: Math.round(legendFontSize * scale) };
                if (chartOptions.plugins.title) {
                    const titleFontSize = ((chartOptions.plugins.title.font && chartOptions.plugins.title.font.size) || 14);
                    chartOptions.plugins.title.font = { size: Math.round(titleFontSize * scale) };
                }
                if (!chartOptions.scales) chartOptions.scales = {};
                ['x', 'y'].forEach(axis => {
                    if (!chartOptions.scales[axis]) chartOptions.scales[axis] = {};
                    const ax = chartOptions.scales[axis];
                    if (!ax.ticks) ax.ticks = {};
                    const tickSize = ((ax.ticks.font && ax.ticks.font.size) || 12);
                    ax.ticks.font = { size: Math.round(tickSize * scale) };
                    if (!ax.grid) ax.grid = {};
                    ax.grid.lineWidth = Math.max(1, ((ax.grid.lineWidth || 1) / scale));
                    if (ax.title) {
                        const titleSize = ((ax.title.font && ax.title.font.size) || 14);
                        ax.title.font = { size: Math.round(titleSize * scale) };
                    }
                });
                if (chartData && chartData.datasets) {
                    chartData.datasets.forEach(ds => {
                        ds.borderWidth = preferThin ? 0.4 : Math.max(1, (ds.borderWidth || 2) / scale);
                        ds.borderCapStyle = preferThin ? 'butt' : ds.borderCapStyle;
                        ds.borderJoinStyle = preferThin ? 'miter' : ds.borderJoinStyle;
                        ds.pointRadius = ((ds.pointRadius || 3) * scale);
                    });
                }
            }

            async function generateReport() {
                if (!analysisResults || (!analysisResults.groupA && !analysisResults.groupB)) {
                    alert("è«‹å…ˆåŸ·è¡Œåˆ†æä»¥ç”¢ç”Ÿçµæœ!");
                    return;
                }

                // --- æ ¸å½ˆç´šä¿®å¾©ï¼šæˆªåœ–å‰å…ˆæ¸…ç† DOM ---
                // 1. å¼·åˆ¶è®“ MathJax å®Œæˆæ¸²æŸ“
                if (window.MathJax && window.MathJax.typesetPromise) {
                    await window.MathJax.typesetPromise();
                }

                // 2. å¯¦é«”ç§»é™¤æ‰€æœ‰éš±å½¢é‡å½±å…ƒç´  (mjx-assistive-mml)
                const ghosts = document.querySelectorAll('mjx-assistive-mml');
                if (ghosts.length > 0) {
                    console.log(`[System] Found ${ghosts.length} ghost elements. Removing them...`);
                    // æš«ä¸å½ˆå‡º alert æ‰“æ“¾ï¼Œç›´æ¥é»˜é»˜ç§»é™¤ï¼Œé™¤éæ¸¬è©¦éœ€è¦
                    ghosts.forEach(el => el.remove());
                }

                const reportArea = document.getElementById('reportArea');

                const loadingMsg = document.createElement('div');
                loadingMsg.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.8);color:white;padding:20px 40px;border-radius:8px;font-size:1.2em;z-index:9999;';
                loadingMsg.textContent = 'æ­£åœ¨å„ªåŒ–ä¸¦ç”Ÿæˆå ±å‘Š...';
                document.body.appendChild(loadingMsg);

                try {
                    const scale = 3; // é™ä½å€ç‡ä»¥æ¸›å°‘åæ¨™åç§»å°è‡´çš„é‡å½±

                    const originalCanvas = await html2canvas(reportArea, {
                        scale: scale,
                        useCORS: true,
                        backgroundColor: '#ffffff', // å¼·åˆ¶ç™½åº•
                        logging: false,
                        width: Math.min(reportArea.scrollWidth, 1400),
                        height: reportArea.scrollHeight,
                        windowWidth: Math.min(document.body.scrollWidth, 1400),
                        onclone: (clonedDoc) => {
                            // å†æ¬¡æª¢æŸ¥ clone çš„æ–‡ä»¶
                            const cloneGhosts = clonedDoc.querySelectorAll('mjx-assistive-mml');
                            cloneGhosts.forEach(el => el.remove());

                            const clonedArea = clonedDoc.getElementById('reportArea');
                            if (clonedArea) {
                                clonedArea.style.margin = '0 auto';
                                clonedArea.style.overflow = 'visible';
                                clonedArea.style.backgroundColor = '#ffffff';
                                // ç§»é™¤é™°å½±èˆ‡å‹•ç•«
                                clonedArea.style.boxShadow = 'none';
                                clonedArea.style.animation = 'none';
                            }

                            // å¼·åˆ¶æ‰€æœ‰æ–‡å­—æ¨£å¼
                            const all = clonedDoc.querySelectorAll('*');
                            all.forEach(el => {
                                el.style.textShadow = 'none';
                                el.style.boxShadow = 'none';
                                if (el.tagName.toLowerCase().startsWith('mjx-')) {
                                    el.style.backgroundColor = 'transparent'; // é˜²æ­¢æ•¸å­¸å…¬å¼èƒŒæ™¯ç–ŠåŠ 
                                }
                            });
                        }
                    });

                    const padding = 20 * scale;
                    const newCanvas = document.createElement('canvas');
                    newCanvas.width = originalCanvas.width + padding * 2;
                    newCanvas.height = originalCanvas.height + padding * 2;
                    const ctx = newCanvas.getContext('2d');

                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, newCanvas.width, newCanvas.height);
                    ctx.drawImage(originalCanvas, padding, padding);

                    newCanvas.toBlob((blob) => {
                        const link = document.createElement('a');
                        link.href = URL.createObjectURL(blob);
                        const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
                        const mode = analysisResults.mode;
                        link.download = `Weibull_åˆ†æå ±å‘Š_${mode === 'dual' ? 'é›™çµ„æ¯”å°' : 'å–®çµ„'}_${timestamp}.png`;
                        link.click();
                        document.body.removeChild(loadingMsg);
                        alert(`âœ… å ±å‘Šå·²æˆåŠŸç”Ÿæˆ (å·²æ¸…é™¤é‡å½±)!\nå°ºå¯¸: ${newCanvas.width} x ${newCanvas.height}`);
                    }, 'image/png', 1.0);

                } catch (error) {
                    if (document.body.contains(loadingMsg)) document.body.removeChild(loadingMsg);
                    alert("âŒ ç”Ÿæˆå¤±æ•—: " + error.message);
                    console.error(error);
                }
            }

            function drawCharts(resultsA, resultsB) {
                const groupNameA = document.getElementById('groupNameA').value;
                const groupNameB = document.getElementById('groupNameB').value;
                const markerR = markerReliabilityPercent;

                // --- 1. Probability Plot (Scatter) ---
                const probTraces = [];

                if (resultsA) {
                    // Data Points
                    probTraces.push({
                        x: resultsA.points.map(p => p.x),
                        y: resultsA.points.map(p => p.y),
                        mode: 'markers',
                        type: 'scatter',
                        name: `${groupNameA} - å¤±æ•ˆé»`,
                        marker: { color: '#3498db', size: 8 }
                    });

                    // Regression Line
                    let minXA = Math.min(...resultsA.points.map(p => p.x));
                    let maxXA = Math.max(...resultsA.points.map(p => p.x));
                    // Extend line slightly
                    let range = maxXA - minXA;
                    let lineX = [minXA - range * 0.1, maxXA + range * 0.1];
                    let lineY = lineX.map(x => resultsA.slope * x + resultsA.intercept);

                    probTraces.push({
                        x: lineX,
                        y: lineY,
                        mode: 'lines',
                        type: 'scatter',
                        name: `${groupNameA} - è¶¨å‹¢ç·š`,
                        line: { color: '#3498db', width: 2, dash: 'dash' }
                    });
                }

                if (resultsB) {
                    // Data Points
                    probTraces.push({
                        x: resultsB.points.map(p => p.x),
                        y: resultsB.points.map(p => p.y),
                        mode: 'markers',
                        type: 'scatter',
                        name: `${groupNameB} - å¤±æ•ˆé»`,
                        marker: { color: '#e74c3c', size: 8 }
                    });

                    // Regression Line
                    let minXB = Math.min(...resultsB.points.map(p => p.x));
                    let maxXB = Math.max(...resultsB.points.map(p => p.x));
                    let range = maxXB - minXB;
                    let lineX = [minXB - range * 0.1, maxXB + range * 0.1];
                    let lineY = lineX.map(x => resultsB.slope * x + resultsB.intercept);

                    probTraces.push({
                        x: lineX,
                        y: lineY,
                        mode: 'lines',
                        type: 'scatter',
                        name: `${groupNameB} - è¶¨å‹¢ç·š`,
                        line: { color: '#e74c3c', width: 2, dash: 'dash' }
                    });
                }

                const probLayout = {
                    title: { text: (resultsA && resultsB) ? 'Weibull Probability Plot - é›™çµ„æ¯”å°' : 'Weibull Probability Plot' },
                    xaxis: { title: 'ln(t)' },
                    yaxis: { title: 'ln(-ln(1-F(t)))' },
                    margin: { t: 40, r: 20, l: 60, b: 40 },
                    showlegend: true,
                    legend: { x: 0.02, y: 1 },
                    hovermode: 'closest',
                    plot_bgcolor: '#fff',
                    paper_bgcolor: '#fff'
                };

                Plotly.newPlot('chartProb', probTraces, probLayout, { responsive: true, displayModeBar: true });


                // --- 2. Reliability Plot (Line) ---
                const relTraces = [];
                const shapes = [];
                const annotations = [];

                // Helper to generate curve points
                // props = { xanchor, yanchor, xshift, yshift }
                const generateCurve = (res, color, name, props = { xanchor: 'center', yanchor: 'bottom', xshift: 0, yshift: 20 }) => {
                    let points = [];
                    let plotMax = res.maxT * 1.5;
                    let step = plotMax / 500;
                    for (let t = 0; t <= plotMax; t += step) {
                        let R = Math.exp(-Math.pow(t / res.eta, res.beta)) * 100;
                        points.push({ t, R });
                    }

                    // Main Curve
                    relTraces.push({
                        x: points.map(p => p.t),
                        y: points.map(p => p.R),
                        mode: 'lines',
                        type: 'scatter',
                        name: `${name} - R(t)`,
                        line: { color: color, width: 2 }
                    });

                    // Marker Point Calculation
                    let tMarker = res.eta * Math.pow(-Math.log(markerR / 100), 1 / res.beta);

                    // Add Marker Point
                    relTraces.push({
                        x: [tMarker],
                        y: [markerR],
                        mode: 'markers',
                        type: 'scatter',
                        name: `${name} - R(${markerR}%)`,
                        marker: { color: color, size: 10, symbol: 'circle' },
                        showlegend: false
                    });

                    // Vertical Dashed Line
                    shapes.push({
                        type: 'line',
                        x0: tMarker, y0: 0,
                        x1: tMarker, y1: markerR,
                        line: { color: color, width: 1, dash: 'dash' }
                    });

                    // Horizontal Dashed Line (Optional, but helps read value)
                    shapes.push({
                        type: 'line',
                        x0: 0, y0: markerR,
                        x1: tMarker, y1: markerR,
                        line: { color: '#aaa', width: 1, dash: 'dot' }
                    });

                    // Annotation
                    annotations.push({
                        x: tMarker,
                        y: markerR,
                        xref: 'x', yref: 'y',
                        text: `t=${tMarker.toFixed(1)}`,
                        showarrow: false,
                        xanchor: props.xanchor,
                        yanchor: props.yanchor,
                        xshift: props.xshift,
                        yshift: props.yshift,
                        bgcolor: color,
                        font: { color: 'white' },
                        bordercolor: color,
                        borderwidth: 1,
                        borderpad: 4
                    });

                    return tMarker;
                };

                // åœ¨é›™çµ„æ¨¡å¼ä¸‹ï¼Œåˆ†é…ä¸åŒçš„ä½ç½®
                // Group A: å·¦ä¸‹æ–¹ (Bottom-Left relative to label, so Top-Right anchor logic? No, position logic)
                // Plotly anchors define which part of the TEXT BOX is at the coordinate.

                // Group A (Blue) -> Label at Bottom-Left of point
                // Anchor logic: xanchor='right' (box right touches point), yanchor='top' (box top touches point)
                const propsA = { xanchor: 'right', yanchor: 'top', xshift: -5, yshift: -5 };

                // Group B (Red) -> Label at Top-Right of point
                // Anchor logic: xanchor='left' (box left touches point), yanchor='bottom' (box bottom touches point)
                const propsB = { xanchor: 'left', yanchor: 'bottom', xshift: 5, yshift: 5 };

                // Single Mode Default: Top Center
                const propsDefault = { xanchor: 'center', yanchor: 'bottom', xshift: 0, yshift: 15 };

                if (resultsA) {
                    // å¦‚æœæœ‰ Bï¼Œå‰‡ç”¨ A å°ˆå±¬ä½ç½®ï¼›å¦å‰‡ç”¨é è¨­å±…ä¸­
                    let p = resultsB ? propsA : propsDefault;
                    generateCurve(resultsA, '#3498db', groupNameA, p);
                }

                if (resultsB) {
                    let p = resultsA ? propsB : propsDefault;
                    generateCurve(resultsB, '#e74c3c', groupNameB, p);
                }

                const relLayout = {
                    title: { text: (resultsA && resultsB) ? 'å¯é åº¦æ›²ç·š (Reliability Curve)' : 'å¯é åº¦æ›²ç·š (Reliability Curve)' },
                    xaxis: { title: 'å£½å‘½ (t)' },
                    yaxis: { title: 'å¯é åº¦ (%)', range: [0, 105] },
                    margin: { t: 40, r: 20, l: 60, b: 40 },
                    showlegend: true,
                    legend: { x: 1, y: 1, xanchor: 'right' },
                    hovermode: 'x unified',
                    shapes: shapes,
                    annotations: annotations,
                    plot_bgcolor: '#fff',
                    paper_bgcolor: '#fff'
                };

                Plotly.newPlot('chartRel', relTraces, relLayout, { responsive: true, displayModeBar: true });
            }
        </script>

</body>