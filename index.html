<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Weibull Reliability Analytics | Mouldex Professional</title>

    <!-- Library Inclusion -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js" charset="utf-8"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Design System -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="app-wrapper">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="logo-container">
                <div class="logo-text">MOULDEX ANALYTICS</div>
            </div>
            <nav>
                <a href="#" class="nav-item active" onclick="scrollToTop()">
                    <i class="fas fa-chart-line"></i>
                    <span class="nav-text">可靠度分析</span>
                </a>
                <a href="#" class="nav-item" onclick="openTheoryTab('basics')">
                    <i class="fas fa-book"></i>
                    <span class="nav-text">理論知識庫</span>
                </a>
                <a href="#" class="nav-item" onclick="exportData()">
                    <i class="fas fa-file-csv"></i>
                    <span class="nav-text">數據匯出</span>
                </a>
                <a href="#" class="nav-item" onclick="generateReport()">
                    <i class="fas fa-file-pdf"></i>
                    <span class="nav-text">分析報告</span>
                </a>
            </nav>
            <div style="margin-top: auto; font-size: 0.75rem; color: #475569;">
                v4.5 Enterprise Edition<br>
                © 2026 Mouldex Inc.
            </div>
        </aside>

        <!-- Main Workspace -->
        <main class="main-content">
            <header class="page-header">
                <div class="title-section">
                    <h1>Weibull 可靠度分析工具</h1>
                    <p>專業級工程數據擬合與失效模式預測定量系統</p>
                </div>
                <div class="btn-group">
                    <button class="btn-premium btn-secondary" onclick="loadDemoCombined()">
                        <i class="fas fa-magic"></i> 載入基準範例
                    </button>
                    <button class="btn-premium btn-primary" onclick="runAnalysis()">
                        <i class="fas fa-play"></i> 執行全局分析
                    </button>
                </div>
            </header>

            <div id="reportArea">
                <div class="dashboard-grid">
                    <!-- Group A Configuration -->
                    <section class="card">
                        <div class="card-title">
                            <span><i class="fas fa-layer-group"></i> 實驗組 A 配置</span>
                            <span class="badge badge-a">Primary Group</span>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label>組別識別碼</label>
                                <input type="text" id="groupNameA" class="input-control" value="原始設計 (Group A)">
                            </div>
                            <div class="input-group">
                                <label>快速輸入 (壽命 t / 狀態 s)</label>
                                <div style="display: flex; gap: 8px;">
                                    <input type="number" id="tInputA" class="input-control" placeholder="壽命" step="any">
                                    <select id="sInputA" class="input-control" style="width: 100px;">
                                        <option value="F">失效 (F)</option>
                                        <option value="S">設限 (S)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="btn-group" style="margin-bottom: 20px;">
                            <button class="btn-premium btn-secondary" onclick="showBatchInput('A')">
                                <i class="fas fa-list-ol"></i> 批次匯入
                            </button>
                            <button class="btn-premium btn-secondary" onclick="loadDemo('A')">
                                <i class="fas fa-lightbulb"></i> 範例數據
                            </button>
                            <button class="btn-premium btn-ghost-danger" onclick="clearData('A')">
                                <i class="fas fa-eraser"></i> 清空
                            </button>
                        </div>
                        <div class="table-wrapper">
                            <table class="premium-table" id="dataTableA">
                                <thead>
                                    <tr>
                                        <th style="width: 60px;">ID</th>
                                        <th>壽命數據 (t)</th>
                                        <th>狀態指標</th>
                                        <th style="width: 60px;">操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="4" style="text-align: center; color: #94a3b8; padding: 40px;">
                                            尚未選取數據點</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- Group B Configuration -->
                    <section class="card">
                        <div class="card-title">
                            <span><i class="fas fa-layer-group"></i> 實驗組 B 配置</span>
                            <span class="badge badge-b">Comparison Group</span>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label>組別識別碼</label>
                                <input type="text" id="groupNameB" class="input-control" value="優化方案 (Group B)">
                            </div>
                            <div class="input-group">
                                <label>快速輸入 (壽命 t / 狀態 s)</label>
                                <div style="display: flex; gap: 8px;">
                                    <input type="number" id="tInputB" class="input-control" placeholder="壽命" step="any">
                                    <select id="sInputB" class="input-control" style="width: 100px;">
                                        <option value="F">失效 (F)</option>
                                        <option value="S">設限 (S)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="btn-group" style="margin-bottom: 20px;">
                            <button class="btn-premium btn-secondary" onclick="showBatchInput('B')">
                                <i class="fas fa-list-ol"></i> 批次匯入
                            </button>
                            <button class="btn-premium btn-secondary" onclick="loadDemo('B')">
                                <i class="fas fa-lightbulb"></i> 範例數據
                            </button>
                            <button class="btn-premium btn-ghost-danger" onclick="clearData('B')">
                                <i class="fas fa-eraser"></i> 清空
                            </button>
                        </div>
                        <div class="table-wrapper">
                            <table class="premium-table" id="dataTableB">
                                <thead>
                                    <tr>
                                        <th style="width: 60px;">ID</th>
                                        <th>壽命數據 (t)</th>
                                        <th>狀態指標</th>
                                        <th style="width: 60px;">操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="4" style="text-align: center; color: #94a3b8; padding: 40px;">
                                            尚未選取數據點</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- Analytical Results -->
                    <section class="card full-width" id="resultPanel" style="display: none;">
                        <div class="card-title">
                            <span><i class="fas fa-square-root-variable"></i> 工程參數化結果</span>
                            <div class="formula-display" style="margin: 0; padding: 8px 20px; font-size: 1rem;">
                                \( R(t) = e^{-(t/\eta)^\beta} \)
                            </div>
                        </div>

                        <div class="dashboard-grid">
                            <!-- Group A Stats -->
                            <div id="groupResultA" class="card"
                                style="background: #fcfdfe; border-left: 6px solid var(--brand-accent-a);">
                                <h4
                                    style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                                    <span id="groupATitleResult">Group A Result</span>
                                    <span style="font-size: 0.8rem; color: var(--text-muted);" id="descTextA">-</span>
                                </h4>
                                <div class="metric-grid">
                                    <div class="metric-card">
                                        <div class="metric-label">Shape (Beta β)</div>
                                        <div class="metric-value" style="color: var(--brand-accent-a);" id="valBetaA">-
                                        </div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-label">Scale (Eta η)</div>
                                        <div class="metric-value" style="color: var(--brand-accent-a);" id="valEtaA">-
                                        </div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-label">Fitness (R²)</div>
                                        <div class="metric-value" style="color: var(--brand-accent-a);" id="valR2A">-
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Group B Stats -->
                            <div id="groupResultB" class="card"
                                style="background: #fcfdfe; border-left: 6px solid var(--brand-accent-b);">
                                <h4
                                    style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                                    <span id="groupBTitleResult">Group B Result</span>
                                    <span style="font-size: 0.8rem; color: var(--text-muted);" id="descTextB">-</span>
                                </h4>
                                <div class="metric-grid">
                                    <div class="metric-card">
                                        <div class="metric-label">Shape (Beta β)</div>
                                        <div class="metric-value" style="color: var(--brand-accent-b);" id="valBetaB">-
                                        </div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-label">Scale (Eta η)</div>
                                        <div class="metric-value" style="color: var(--brand-accent-b);" id="valEtaB">-
                                        </div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-label">Fitness (R²)</div>
                                        <div class="metric-value" style="color: var(--brand-accent-b);" id="valR2B">-
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="diff-card" id="diffPanel" style="display: none;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3 style="margin:0;"><i class="fas fa-random"></i> 壽命改善定量分析</h3>
                                <div id="diffInterpretation"
                                    style="font-weight: 700; background: rgba(255,255,255,0.1); padding: 8px 16px; border-radius: 8px;">
                                    -</div>
                            </div>
                            <div class="metric-grid">
                                <div class="metric-card" style="background: rgba(255,255,255,0.05);">
                                    <div class="metric-label" style="color: #cbd5e1;">Beta Delta</div>
                                    <div class="metric-value" id="diffBeta">-</div>
                                </div>
                                <div class="metric-card" style="background: rgba(255,255,255,0.05);">
                                    <div class="metric-label" style="color: #cbd5e1;">Eta Delta</div>
                                    <div class="metric-value" id="diffEta">-</div>
                                </div>
                                <div class="metric-card" style="background: rgba(255,255,255,0.2);">
                                    <div class="metric-label" style="color: #fff;">Overall Improvement</div>
                                    <div class="metric-value" id="diffImprovement">-</div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Charts Area -->
                    <div class="card chart-card">
                        <div class="card-title">
                            <span><i class="fas fa-chart-area"></i> Weibull Probability Distribution</span>
                            <button class="btn-premium btn-secondary" style="padding: 4px 10px;"
                                onclick="exportSingleChart('chartProb')">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                        <div id="chartProb" style="height:550px;"></div>
                    </div>

                    <div class="card chart-card">
                        <div class="card-title" style="margin-bottom: 10px;">
                            <span><i class="fas fa-chart-line"></i> Reliability Curve Evaluation</span>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <label style="font-size: 0.75rem; color: var(--text-muted);">標示 R(t) %</label>
                                <input id="inputReliability" type="number" min="0.1" max="99.9" value="95"
                                    class="input-control" style="width: 80px; padding: 6px;">
                                <button class="btn-premium btn-secondary" style="padding: 4px 10px;"
                                    onclick="exportSingleChart('chartRel')">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div id="chartRel" style="height:540px;"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="batchModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 id="batchTitle">數據批次匯入</h3>
                <i class="fas fa-times" style="cursor: pointer;" onclick="closeBatchInput()"></i>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 16px; color: var(--text-muted); font-size: 0.875rem;">支援由 Excel/CSV
                    複製貼上。格式：<code>壽命, 狀態</code> (F=失效, S=設限)</p>
                <textarea id="batchTextarea" class="input-control"
                    style="height: 250px; font-family: 'JetBrains Mono', monospace;"
                    placeholder="120, F&#10;145, F&#10;200, S"></textarea>
                <div class="btn-group" style="margin-top: 24px; justify-content: flex-end;">
                    <button class="btn-premium btn-secondary" onclick="closeBatchInput()">取消</button>
                    <button class="btn-premium btn-primary" onclick="processBatchInput()">確認匯入</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Knowledge Base Modal (Restored & Enhanced) -->
    <div id="theoryModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-book-open"></i> Weibull 分析核心知識庫</h3>
                <i class="fas fa-times" style="cursor: pointer;" onclick="closeTheory()"></i>
            </div>
            <nav class="tabs-nav" style="padding: 0 32px;">
                <div class="tab-link active" onclick="switchTheoryTab('basics')">基礎概念</div>
                <div class="tab-link" onclick="switchTheoryTab('params')">參數解讀</div>
                <div class="tab-link" onclick="switchTheoryTab('blife')">B-Life 應用</div>
                <div class="tab-link" onclick="switchTheoryTab('samples')">樣本建議</div>
            </nav>
            <div class="modal-body">
                <!-- Basics -->
                <div id="theory-basics" class="theory-section">
                    <h2>1. 數據性質與類型</h2>
                    <p>可靠度分析中，數據主要分為兩大類：</p>
                    <div class="dashboard-grid" style="grid-template-columns: 1fr 1fr; margin-bottom: 24px;">
                        <div class="highlight-box" style="border-color: var(--brand-accent-b); background: #fff1f2;">
                            <h4 style="color: var(--brand-accent-b);">失效數據 (Failure, F)</h4>
                            <p>產品在測試中確實發生故障的時間點。這是精確的失效訊息。</p>
                        </div>
                        <div class="highlight-box" style="border-color: var(--brand-accent-a); background: #eff6ff;">
                            <h4 style="color: var(--brand-accent-a);">右設限數據 (Suspended, S)</h4>
                            <p>測試結束時產品仍完好，我們僅知道其壽命「大於」當前時間。雖然非失效，但提供了極重要的「存活長度」訊息。</p>
                        </div>
                    </div>
                    <h2>2. 可靠度 R(t) 與 失效率 F(t)</h2>
                    <p>這兩者互為補數，和永遠為 100%。</p>
                    <div class="formula-card">\( R(t) + F(t) = 1 \)</div>
                    <p><b>R(t)：</b> 在時間 t 時，產品完好的機率 (Reliability or Survival Rate)。</p>
                    <p><b>F(t)：</b> 在時間 t 以前，產品已經失效的累積機率 (Cumulative Probability of Failure)。</p>
                </div>

                <!-- Parameters -->
                <div id="theory-params" class="theory-section" style="display:none;">
                    <h2>3. Weibull 分佈關鍵參數</h2>
                    <div class="highlight-box">
                        <h3>形狀參數 Shape (Beta β)</h3>
                        <p>決定了產品的「失效機制」：</p>
                        <ul>
                            <li><b>β < 1：</b> 早期失效 (Infant Mortality)。隨時間失效率降低。</li>
                            <li><b>β = 1：</b> 隨機失效 (Exponential Distribution)。失效率為常數。</li>
                            <li><b>β > 1：</b> 磨耗失效 (Wear-out)。隨時間失效率上升，代表老化。</li>
                        </ul>
                    </div>
                    <div class="highlight-box" style="border-color: var(--warning);">
                        <h3>尺度參數 Scale (Eta η)</h3>
                        <p>又稱「特徵壽命」。此時間點代表累積 <b>63.2%</b> 的產品已經失效。</p>
                        <p>當 \( t = \eta \) 時，\( R(\eta) = e^{-1} \approx 36.8\% \)。</p>
                    </div>
                    <div class="highlight-box" style="border-color: var(--success); background: #ecfdf5;">
                        <h3>擬合優度 (R-squared R²)</h3>
                        <p>代表 Weibull 回歸線與原始數據的契合程度。專業實務建議 R² > 0.90 為佳。</p>
                    </div>
                </div>

                <!-- B-Life -->
                <div id="theory-blife" class="theory-section" style="display:none;">
                    <h2>4. B-Life 工程指標</h2>
                    <p>B-Life 指標代表「當特定比例失效時的時間」。</p>
                    <table class="premium-table">
                        <thead style="background: #f1f5f9;">
                            <tr>
                                <th>指標</th>
                                <th>意義</th>
                                <th>失效比例</th>
                                <th>工程應用</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><b>B1</b></td>
                                <td>極高品質指標</td>
                                <td>1% 失效</td>
                                <td>航太、醫療、安全氣囊</td>
                            </tr>
                            <tr>
                                <td><b>B10</b></td>
                                <td>行業標準壽命</td>
                                <td>10% 失效</td>
                                <td>汽車、馬達、保固期設定</td>
                            </tr>
                            <tr>
                                <td><b>B50</b></td>
                                <td>中位數壽命</td>
                                <td>50% 失效</td>
                                <td>衡量平均表現</td>
                            </tr>
                            <tr>
                                <td><b>B63.2</b></td>
                                <td>特徵壽命 η</td>
                                <td>63.2% 失效</td>
                                <td>數學計算基準</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Samples -->
                <div id="theory-samples" class="theory-section" style="display:none;">
                    <h2>5. 統計樣本數量建議</h2>
                    <p>雖然 2 個失效點即可擬合線條，但精確度由樣本數決定：</p>
                    <div class="dashboard-grid">
                        <div class="metric-card">
                            <div class="metric-label" style="color:var(--danger)">3-5 顆</div>
                            <div style="font-size: 0.9rem;">極高風險，僅看趨勢</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label" style="color:var(--warning)">6-10 顆</div>
                            <div style="font-size: 0.9rem;">初步驗證，B10 誤差大</div>
                        </div>
                        <div class="metric-card" style="background: #ecfdf5; border: 1px solid var(--success);">
                            <div class="metric-label" style="color:var(--success)">10-20 顆</div>
                            <div style="font-size: 0.9rem;">工程甜蜜點，推薦方案</div>
                        </div>
                        <div class="metric-card" style="background: #eff6ff; border: 1px solid var(--brand-accent-a);">
                            <div class="metric-label" style="color:var(--brand-accent-a)">20+ 顆</div>
                            <div style="font-size: 0.9rem;">高品質科研與安全等級</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer"
                style="padding: 24px 32px; border-top: 1px solid var(--border); text-align: right;">
                <button class="btn-premium btn-primary" onclick="closeTheory()">關閉指南</button>
            </div>
        </div>
    </div>

    <!-- Scripting -->
    <script src="app.js"></script>
</body>

</html>