<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weibull 可靠度分析 - Mouldex 專業版</title>

    <!-- 外部庫 -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js" charset="utf-8"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- 本地樣式 -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <div id="reportArea">
            <header class="main-header">
                <h1 class="main-title">Weibull 可靠度分析系統</h1>
                <p class="subtitle">
                    <i class="fas fa-microchip"></i> 支援雙組數據比對與失效模式診斷 (Mouldex 專用)
                </p>
            </header>

            <!-- 上半部：輸入面板與結果 -->
            <div class="top-section">
                <!-- 組別 A -->
                <div class="group-panel group-a">
                    <div class="group-header">
                        <i class="fas fa-vial"></i> 組別 A
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-tag"></i> 組別名稱</label>
                        <input type="text" id="groupNameA" class="calc-input" value="組別 A">
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-stopwatch"></i> 壽命 (t)</label>
                        <input type="number" id="tInputA" class="calc-input" placeholder="輸入後按 Enter" step="any">
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-info-circle"></i> 狀態</label>
                        <select id="sInputA" class="calc-input">
                            <option value="F">失效 (Failure)</option>
                            <option value="S">右設限 (Suspended)</option>
                        </select>
                    </div>

                    <div class="button-grid">
                        <button class="btn btn-add" onclick="showBatchInput('A')">
                            <i class="fas fa-file-import"></i> 批次匯入
                        </button>
                        <button class="btn btn-demo" onclick="loadDemo('A')">
                            <i class="fas fa-lightbulb"></i> 範例數據
                        </button>
                    </div>
                    <button class="btn btn-clear" onclick="clearData('A')">
                        <i class="fas fa-trash"></i> 清空此組
                    </button>

                    <div class="table-container">
                        <table class="data-table" id="dataTableA">
                            <thead>
                                <tr>
                                    <th>序號</th>
                                    <th>壽命</th>
                                    <th>狀態</th>
                                    <th>刪除</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <!-- 組別 B -->
                <div class="group-panel group-b">
                    <div class="group-header">
                        <i class="fas fa-flask"></i> 組別 B
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-tag"></i> 組別名稱</label>
                        <input type="text" id="groupNameB" class="calc-input" value="組別 B">
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-stopwatch"></i> 壽命 (t)</label>
                        <input type="number" id="tInputB" class="calc-input" placeholder="輸入後按 Enter" step="any">
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-info-circle"></i> 狀態</label>
                        <select id="sInputB" class="calc-input">
                            <option value="F">失效 (Failure)</option>
                            <option value="S">右設限 (Suspended)</option>
                        </select>
                    </div>

                    <div class="button-grid">
                        <button class="btn btn-add-b" onclick="showBatchInput('B')">
                            <i class="fas fa-file-import"></i> 批次匯入
                        </button>
                        <button class="btn btn-demo" onclick="loadDemo('B')">
                            <i class="fas fa-lightbulb"></i> 範例數據
                        </button>
                    </div>
                    <button class="btn btn-clear" onclick="clearData('B')">
                        <i class="fas fa-trash"></i> 清空此組
                    </button>

                    <div class="table-container">
                        <table class="data-table" id="dataTableB">
                            <thead>
                                <tr>
                                    <th>序號</th>
                                    <th>壽命</th>
                                    <th>狀態</th>
                                    <th>刪除</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <!-- 結果面板 -->
                <div class="result-panel" id="resultPanel">
                    <div class="result-title">
                        <i class="fas fa-chart-pie"></i> 參數分析結果
                    </div>

                    <div class="formula-display">
                        \( R(t) = e^{-(t/\eta)^\beta} \)
                    </div>

                    <div class="comparison-grid">
                        <div class="group-result group-a" id="groupResultA">
                            <h4 id="groupATitleResult">組別 A</h4>
                            <div class="stat-grid">
                                <div>
                                    <div class="stat-label">Beta (β)</div>
                                    <div class="stat-value" id="valBetaA">-</div>
                                </div>
                                <div>
                                    <div class="stat-label">Eta (η)</div>
                                    <div class="stat-value" id="valEtaA">-</div>
                                </div>
                                <div>
                                    <div class="stat-label">R²</div>
                                    <div class="stat-value" id="valR2A">-</div>
                                </div>
                            </div>
                            <p id="descTextA" style="font-size: 0.8rem; margin-top: 10px; opacity: 0.8;"></p>
                        </div>

                        <div class="group-result group-b" id="groupResultB">
                            <h4 id="groupBTitleResult">組別 B</h4>
                            <div class="stat-grid">
                                <div>
                                    <div class="stat-label">Beta (β)</div>
                                    <div class="stat-value" id="valBetaB">-</div>
                                </div>
                                <div>
                                    <div class="stat-label">Eta (η)</div>
                                    <div class="stat-value" id="valEtaB">-</div>
                                </div>
                                <div>
                                    <div class="stat-label">R²</div>
                                    <div class="stat-value" id="valR2B">-</div>
                                </div>
                            </div>
                            <p id="descTextB" style="font-size: 0.8rem; margin-top: 10px; opacity: 0.8;"></p>
                        </div>
                    </div>

                    <div class="diff-panel" id="diffPanel">
                        <h4><i class="fas fa-balance-scale"></i> 差異分析 (B vs A)</h4>
                        <div class="stat-grid">
                            <div>
                                <div class="stat-label">Beta 變動</div>
                                <div class="stat-value" id="diffBeta" style="color: #92400e;">-</div>
                            </div>
                            <div>
                                <div class="stat-label">Eta 變動</div>
                                <div class="stat-value" id="diffEta" style="color: #92400e;">-</div>
                            </div>
                            <div>
                                <div class="stat-label">改善率</div>
                                <div class="stat-value" id="diffImprovement" style="color: #92400e;">-</div>
                            </div>
                        </div>
                        <div id="diffInterpretation" style="margin-top: 10px; font-weight: 500; font-size: 0.9rem; color: #92400e;"></div>
                    </div>
                </div>
            </div>

            <!-- 控制區 -->
            <div class="control-section">
                <div class="button-grid-six">
                    <button class="btn-uniform btn-calc" onclick="runAnalysis()">
                        <i class="fas fa-calculator"></i> 執行分析
                    </button>
                    <button class="btn-uniform btn-export" onclick="exportData()">
                        <i class="fas fa-file-csv"></i> 數據匯出
                    </button>
                    <button class="btn-uniform btn-export" onclick="exportCharts()">
                        <i class="fas fa-file-image"></i> 圖表匯出
                    </button>
                    <button class="btn-uniform btn-report" onclick="generateReport()">
                        <i class="fas fa-file-pdf"></i> 生成報告
                    </button>
                    <button class="btn-uniform btn-clear-all" onclick="clearAllData()">
                        <i class="fas fa-broom"></i> 全部清空
                    </button>
                    <button class="btn-uniform btn-theory" onclick="openTheory()">
                        <i class="fas fa-book"></i> 理論指南
                    </button>
                </div>
            </div>

            <!-- 圖表區 -->
            <div class="charts-container">
                <div class="chart-box">
                    <div id="chartProb" style="height:500px;"></div>
                </div>
                <div class="chart-box">
                    <div class="input-group" style="margin-bottom: 20px; max-width: 250px;">
                        <label><i class="fas fa-highlighter"></i> 標示可靠度 (%):</label>
                        <input id="inputReliability" type="number" min="0.1" max="99.9" value="95" class="calc-input">
                    </div>
                    <div id="chartRel" style="height:500px;"></div>
                </div>
            </div>
        </div>

        <!-- 批次輸入彈窗 -->
        <div id="batchModal" class="batch-modal" style="display: none;">
            <div class="batch-modal-content">
                <span class="batch-close" onclick="closeBatchInput()">&times;</span>
                <div class="batch-title" id="batchTitle">批次輸入數據</div>
                <textarea id="batchTextarea" class="batch-textarea" style="width:100%; height:200px; padding:15px; border-radius:12px; margin-bottom:15px;"
                    placeholder="格式：壽命,狀態 (每行一筆)&#10;例如：&#10;100,F&#10;150,F&#10;200,S"></textarea>
                <div class="button-grid">
                    <button class="btn btn-add" onclick="processBatchInput()">確認匯入</button>
                    <button class="btn btn-demo" onclick="closeBatchInput()">取消</button>
                </div>
                <div class="batch-help" style="margin-top:20px; font-size:0.875rem; color:var(--text-muted);">
                    <p><strong>💡 提示：</strong> 支援 Tab、逗號、空格分隔。狀態 F=失效，S=設限。</p>
                </div>
            </div>
        </div>

        <!-- 理論指南彈窗 (簡化結構，樣式由 style.css 控制) -->
        <div id="theoryModal" class="batch-modal" style="display: none;">
            <div class="batch-modal-content" style="max-width: 900px;">
                <span class="batch-close" onclick="closeTheory()">&times;</span>
                <div class="batch-title">📘 Weibull 分析理論指南</div>
                <div class="theory-content" style="max-height: 70vh; overflow-y: auto; padding-right: 10px;">
                    <!-- 此處保留原有的理論內容，但會套用新樣式 -->
                    <div style="text-align: center; margin-bottom: 20px;">
                        <span style="background: var(--primary); color: white; padding: 6px 15px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">專業工程指南</span>
                    </div>
                    
                    <section>
                        <h2 style="color: var(--primary); border-bottom: 2px solid var(--border); padding-bottom: 8px; margin-bottom: 15px;">1. 數據類型</h2>
                        <p><strong>失效 (F):</strong> 產品損壞的確切時間。</p>
                        <p><strong>右設限 (S):</strong> 產品未損壞，已知壽命「至少」為此時間。</p>
                    </section>

                    <section style="margin-top: 25px;">
                        <h2 style="color: var(--primary); border-bottom: 2px solid var(--border); padding-bottom: 8px; margin-bottom: 15px;">2. 關鍵參數</h2>
                        <p><strong>Beta (β):</strong> 形狀參數。β < 1 (早期失效), β = 1 (隨機失效), β > 1 (磨耗失效)。</p>
                        <p><strong>Eta (η):</strong> 尺度參數/特徵壽命。代表 63.2% 產品失效的時間點。</p>
                    </section>

                    <section style="margin-top: 25px;">
                        <h2 style="color: var(--primary); border-bottom: 2px solid var(--border); padding-bottom: 8px; margin-bottom: 15px;">3. B-Life 意義</h2>
                        <p><strong>B10:</strong> 10% 產品失效的時間，常用於保固期設定。</p>
                        <p><strong>B1:</strong> 1% 產品失效的時間，用於高安全標準產品。</p>
                    </section>
                </div>
                <div style="margin-top: 25px; text-align: center;">
                    <button class="btn btn-add" onclick="closeTheory()" style="min-width: 150px;">理解了</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 本地腳本 -->
    <script src="app.js"></script>
</body>

</html>